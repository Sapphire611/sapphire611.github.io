(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{458:function(s,t,a){"use strict";a.r(t);var n=a(1),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"mongodb-shard-demo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-shard-demo"}},[s._v("#")]),s._v(" MongoDB Shard Demo")]),s._v(" "),t("div",{staticClass:"custom-block right"},[t("p",[s._v("测试环境：Mac\n已安装Docker相关环境\n请确保 27017 ～ 27020 端口没有被占用\n来自 "),t("a",{attrs:{href:"http://sapphire611.github.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sapphire611"),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"_1-docker-compose-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-compose-yml"}},[s._v("#")]),s._v(" 1. docker-compose.yml")]),s._v(" "),t("blockquote",[t("p",[s._v("在目录下，创建docker-compose.yml文件")])]),s._v(" "),t("blockquote",[t("p",[s._v("--bind_ip_all 添加后，本地才能访问到")])]),s._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置服务器 (Config Server)")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configsvr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("configsvr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("replSet configrs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bind_ip_all "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port 27017\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"27019:27017"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" configsvr_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data/configdb\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mongodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分片服务器1 (Shard 1)")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shard1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("shardsvr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("replSet shard1rs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bind_ip_all "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port 27017\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"27018:27017"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" shard1_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data/db\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mongodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分片服务器2 (Shard 2) ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shard2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("shardsvr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("replSet shard2rs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bind_ip_all "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port 27017\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"27020:27017"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" shard2_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data/db\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mongodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由服务器 (Mongos)")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mongos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongos "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("configdb configrs/configsvr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("27017 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bind_ip_all "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port 27017\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"27017:27017"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" configsvr\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" shard1\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" shard2\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mongodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configsvr_data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shard1_data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shard2_data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mongodb-network")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bridge\n")])])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"_2-启用容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-启用容器"}},[s._v("#")]),s._v(" 2. 启用容器")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"_3-创建初始化命令文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建初始化命令文件"}},[s._v("#")]),s._v(" 3. 创建初始化命令文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# init.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 完整分片集群初始化脚本")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"=== 开始初始化MongoDB分片集群 ==="')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 初始化配置服务器副本集")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在初始化配置服务器副本集..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T")]),s._v(" configsvr mongosh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--eval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\nrs.initiate({\n  _id: "configrs",\n  configsvr: true,\n  members: [{ _id: 0, host: "configsvr:27017" }]\n});\n\'')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"完成"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 初始化分片副本集")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在初始化分片1副本集..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T")]),s._v(" shard1 mongosh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--eval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\nrs.initiate({\n  _id: "shard1rs",\n  members: [{ _id: 0, host: "shard1:27017" }]\n});\n\'')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"完成"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在初始化分片2副本集..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T")]),s._v(" shard2 mongosh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--eval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\nrs.initiate({\n  _id: "shard2rs",\n  members: [{ _id: 0, host: "shard2:27017" }]\n});\n\'')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"完成"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 等待副本集初始化完成")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"等待集群初始化(15秒)..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"就绪"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 在mongos上执行分片配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在配置分片集群..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T")]),s._v(" mongos mongosh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--eval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n// 添加分片到集群\nprint("添加分片到集群...");\nsh.addShard("shard1rs/shard1:27017");\nsh.addShard("shard2rs/shard2:27017");\n\n// 对数据库启用分片\nprint("\\n启用数据库分片...");\nsh.enableSharding("sharded_db");\n\n// 创建哈希分片键索引\nprint("\\n创建分片键索引...");\ndb.getSiblingDB("sharded_db").orders.createIndex({ order_id: "hashed" });\n\n// 对集合启用分片\nprint("\\n启用集合分片...");\nsh.shardCollection("sharded_db.orders", { order_id: "hashed" });\n\n// 插入测试数据\nprint("\\n插入测试数据(200条)...");\nfor (let i = 1; i <= 200; i++) {\n  db.getSiblingDB("sharded_db").orders.insertOne({\n    order_id: i,\n    customer: "user_" + Math.floor(Math.random() * 50),\n    amount: Math.random() * 500,\n    created_at: new Date()\n  });\n  if (i % 50 == 0) print("已插入 " + i + " 条");\n}\n\n// 强制刷新分片分布统计\nprint("\\n刷新分片分布统计...");\ndb.adminCommand({ flushRouterConfig: 1 });\n\n// 获取分片分布详情\nprint("\\n=== 详细分片分布 ===");\nprintjson(db.getSiblingDB("sharded_db").orders.getShardDistribution());\n\nprint("\\n✅ 分片集群初始化完成");\n\'')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"=== 初始化脚本执行完成 ==="')]),s._v("\n")])])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"_4-给文件增加执行权限后执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-给文件增加执行权限后执行"}},[s._v("#")]),s._v(" 4. 给文件增加执行权限后执行")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("chmod +x init.sh\n./init.sh\n")])])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"demo输出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#demo输出"}},[s._v("#")]),s._v(" Demo输出")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("liuliyi@liuliyideMacBook-Pro "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" % "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/8\n ✔ Network docker-compose_mongodb-network  Created                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n ✔ Volume "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-compose_shard1_data"')]),s._v("     Created                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n ✔ Volume "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-compose_shard2_data"')]),s._v("     Created                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n ✔ Volume "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-compose_configsvr_data"')]),s._v("  Created                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n ✔ Container docker-compose-configsvr-1    Started                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".4s\n ✔ Container docker-compose-shard2-1       Started                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".3s\n ✔ Container docker-compose-shard1-1       Started                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".3s\n ✔ Container docker-compose-mongos-1       Started                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".4s\nliuliyi@liuliyideMacBook-Pro "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" % ./init.sh\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 开始初始化MongoDB分片集群 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n正在初始化配置服务器副本集"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".完成\n正在初始化分片1副本集"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".完成\n正在初始化分片2副本集"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".完成\n等待集群初始化"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("秒"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("就绪\n正在配置分片集群"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n添加分片到集群"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n启用数据库分片"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n创建分片键索引"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n启用集合分片"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n插入测试数据"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("条"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n已插入 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" 条\n已插入 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" 条\n已插入 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v(" 条\n已插入 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" 条\n\n刷新分片分布统计"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 详细分片分布 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nShard shard1rs at shard1rs/shard1:27017\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  data: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8KiB'")]),s._v(",\n  docs: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("92")]),s._v(",\n  chunks: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'estimated data per chunk'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4KiB'")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'estimated docs per chunk'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n---\nShard shard2rs at shard2rs/shard2:27017\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  data: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9KiB'")]),s._v(",\n  docs: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("108")]),s._v(",\n  chunks: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'estimated data per chunk'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4KiB'")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'estimated docs per chunk'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n---\nTotals\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  data: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'18KiB'")]),s._v(",\n  docs: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(",\n  chunks: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Shard shard1rs'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'46.01 % data'")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'46 % docs in cluster'")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'93B avg obj size on shard'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Shard shard2rs'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'53.98 % data'")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'54 % docs in cluster'")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'93B avg obj size on shard'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n✅ 分片集群初始化完成\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 初始化脚本执行完成 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);