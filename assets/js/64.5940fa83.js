(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{474:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"redis-概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-概念"}},[s._v("#")]),s._v(" Redis 概念")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.bilibili.com/video/BV1Rv41177Af",target:"_blank",rel:"noopener noreferrer"}},[s._v("【尚硅谷】Redis 6 入门到精通 超详细 教程"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_45408390/category_11225849.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("cV 展示的学习园 (这人笔记写的很好)"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("Redis(Remote Dictinary Server),C 语言开发,高性能(key-value)数据库, "),t("strong",[s._v("单线程 + 多路 IO 复用")])])]),s._v(" "),t("h2",{attrs:{id:"docker-redis-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-redis-cli"}},[s._v("#")]),s._v(" Docker & Redis-Cli")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" redis "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),s._v(" always redis "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aha，顺便设置自启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis redis-cli\n")])])]),t("h3",{attrs:{id:"redis-cli-test"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-cli-test"}},[s._v("#")]),s._v(" Redis-Cli-Test")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\nPONG "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 看到这个就代表成功了")]),s._v("\n")])])]),t("h2",{attrs:{id:"redis-五大数据类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-五大数据类型"}},[s._v("#")]),s._v(" Redis 五大数据类型")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("ul",[t("li",[s._v("String (90%+) ， 二进制安全")]),s._v(" "),t("li",[s._v("List ，双向链表")]),s._v(" "),t("li",[s._v("Set ，自动去重 ，字典")]),s._v(" "),t("li",[s._v("Hash ，类似 HashMap，存储键值对")]),s._v(" "),t("li",[s._v("Zset ，有序集合，score（从小到大排列）")])])]),t("h3",{attrs:{id:"medis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#medis"}},[s._v("#")]),s._v(" Medis")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://getmedis.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("【Mac】Medis For Redis GUI"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/qishibo/AnotherRedisDesktopManager/releases/tag/v1.5.5",target:"_blank",rel:"noopener noreferrer"}},[s._v("【Windows】Another Redis Desktop Manager"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"redis-基本操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-基本操作"}},[s._v("#")]),s._v(" Redis 基本操作")]),s._v(" "),t("h3",{attrs:{id:"key-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#key-常用命令"}},[s._v("#")]),s._v(" Key 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("keys *\n\nexists key "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 判断key是否存在")]),s._v("\n\ndel key "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步删除")]),s._v("\nunlink key "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 异步删除")]),s._v("\n\nexpire key "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给key设置过期时间，单位是秒")]),s._v("\nttl key "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time-to-live,查看key还有多久过期，-1永不过期，-2已过期")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换数据库")]),s._v("\n\ndbsize "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前数据库keys的数量")]),s._v("\n\nflushdb "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空当前数据库")]),s._v("\nflushall "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空所有数据库")]),s._v("\n")])])]),t("h3",{attrs:{id:"string-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#string-常用命令"}},[s._v("#")]),s._v(" String 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\nget k1\n\nmset k1 v1 k2 v2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nmsetnx k1 v1 k2 v2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原子性")]),s._v("\nmget k1 k2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nstrlen k1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得k1的长度")]),s._v("\n\nsetnx k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#setnx 只有key不存在时才能成功")]),s._v("\n\ngetrange k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (java) = k1.substring(1,2)")]),s._v("\nsetrange k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" value\n\nsetex k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" v1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时设置过期时间")]),s._v("\ngetset k1 v2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读 & 设置新值")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下命令是原子性操作（不会被线程调度机制打断）")]),s._v("\nincr k1  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# +1")]),s._v("\ndecr k1  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -1")]),s._v("\n\nincrby k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# +10")]),s._v("\ndecrby k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -10")]),s._v("\n")])])]),t("h3",{attrs:{id:"list-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#list-常用命令"}},[s._v("#")]),s._v(" list 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("lpush / rpush k1 v1 k2 v2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlpop / rpop k1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 东西弹光了key就消失了")]),s._v("\n\nrpoplpush k1 k2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 右弹 + 左插")]),s._v("\n\nlrange k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <start> <stop> , 其中 0 -1 代表取所有值")]),s._v("\n\nlindex k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nllen k1\n\nlinsert k2 before/after k1 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')]),s._v("\n\nlrem k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从k1左边删除2个value1")]),s._v("\n\nlset k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将k1中下标为1的值替换成“value2”")]),s._v("\n")])])]),t("h3",{attrs:{id:"set-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#set-常用命令"}},[s._v("#")]),s._v(" Set 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("sadd set1 v1 v2 v3\n\nsmembers set1\nsismember set1 v1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 判断set1中有无v1这个值")]),s._v("\n\nscard set1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回set1中元素个数")]),s._v("\n\nsrem set1 v1 v2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除集合中的元素")]),s._v("\n\nspop set1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 随机从该集合中吐出一个值")]),s._v("\n\nsrandmember set1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 随机从set1中取出3个值，但不会删除它们")]),s._v("\n\nsmove k1 k2 v3 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把v3从k1移到k2中")]),s._v("\n\nsinter k1 k2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交集")]),s._v("\n\nsunion k1 k2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并集")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sdiff")]),s._v(" k1 k2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 差集")]),s._v("\n")])])]),t("h3",{attrs:{id:"hash-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hash-常用命令"}},[s._v("#")]),s._v(" Hash 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hset user "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("611")]),s._v("\nhset user name liuliyi\n\nhmset user "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" name liuliyi611 age "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 批量设置")]),s._v("\n\nhexists user name "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user.name 是否存在")]),s._v("\n\nhkeys user "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询user的所有key")]),s._v("\nhvals user "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询user的所有value")]),s._v("\nhgetall user "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一次性查询user的所有内容")]),s._v("\n\nhincrby user age "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user.age += 10")]),s._v("\n\nhsetnx user wife sara "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只有没有此属性，才能设置成功")]),s._v("\n")])])]),t("h3",{attrs:{id:"zset-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zset-常用命令"}},[s._v("#")]),s._v(" ZSet 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("\nzadd "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" user1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(" user2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" user3  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从小到大排列")]),s._v("\n\nzrange "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v("\nzrange "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" withscores "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# withscores 会带上分数一起显示")]),s._v("\n\nzrangebyscore "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 top 中 90～100 分的")]),s._v("\nzrangebyscore "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" withscores\n\nZREVRANGEBYSCORE "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从大到小排列")]),s._v("\nZREVRANGEBYSCORE "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" withscores\n\nZINCRBY "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" user1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给top中的user1加50")]),s._v("\n\nZREM "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" user\n\nZCOUNT "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\nZRANK "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" user2\n")])])]),t("h2",{attrs:{id:"redis-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-配置文件"}},[s._v("#")]),s._v(" Redis 配置文件")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_45408390/article/details/119730969",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis6 篇 （二）配置文件的介绍"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"redis-发布-订阅"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-发布-订阅"}},[s._v("#")]),s._v(" Redis 发布 & 订阅")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("subscribe channel1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Terminal 1")]),s._v("\npublish channel1 hello "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Terminal 2")]),s._v("\n")])])]),t("h2",{attrs:{id:"redis-新数据类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-新数据类型"}},[s._v("#")]),s._v(" Redis 新数据类型")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_45408390/article/details/119731008",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis6 篇 （三）Redis 新数据类型"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"bitmaps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bitmaps"}},[s._v("#")]),s._v(" BitMaps")]),s._v(" "),t("blockquote",[t("p",[s._v("利用二进制扩展成字符串的方式存储数据,可用于查找用户是否访问过某文章")])]),s._v(" "),t("blockquote",[t("p",[s._v('"abc" = "01100001" + "01100010" + "01100011" = "011000010110001001100011"')])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("SETBIT bitmap1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nGETBIT bitmap1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1")]),s._v("\nGETBIT bitmap1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0")]),s._v("\n\nBITCOUNT bitmap1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 计算bitmap1.count(下标=1)")]),s._v("\nBITCOUNT bitmap1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("end"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以自定义count范围,其中-1代表倒数第一位,-2是倒数第二位，以此类推")]),s._v("\n")])])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[s._v("对于亿级用户来说，使用 Bitmaps 能节省很多的内存空间，但数量很少的情况下适得其反")])]),t("h3",{attrs:{id:"hyperloglog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglog"}},[s._v("#")]),s._v(" HyperLogLog")]),s._v(" "),t("blockquote",[t("p",[s._v("是用来做基数统计(去重后的元素个数)的算法")])]),s._v(" "),t("blockquote",[t("p",[s._v("HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("pfadd HLL1 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test2"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test3"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test1"')]),s._v("\n\npfcount HLL1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3")]),s._v("\n\npfadd HLL2 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test2"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test3"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test4"')]),s._v("\n\npfcount HLL2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3")]),s._v("\n\npfmerge HLL3 HLL1 HLL2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把HLL1和HLL2合并成HLL3")]),s._v("\n\npfcount HLL3 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4")]),s._v("\n")])])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[s._v("HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。")])]),t("h3",{attrs:{id:"geospatial"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#geospatial"}},[s._v("#")]),s._v(" Geospatial")]),s._v(" "),t("blockquote",[t("p",[s._v("Redis 3.2 中增加了对 GEO 类型的支持。GEO，Geographic，地理信息的缩写,在地图上就是经纬度。")])]),s._v(" "),t("blockquote",[t("p",[s._v("redis 基于该类型，提供了经纬度设置，查询，范围查询，距离查询，经纬度 Hash 等常见操作。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geoadd city "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.47")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.23")]),s._v(" shanghai\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geoadd city "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("106.50")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29.53")]),s._v(" chongqing\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" GEOPOS city shanghai\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"121.47000163793563843"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"31.22999903975783553"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" GEOPOS city chongqing\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"106.49999767541885376"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"29.52999957900659211"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" GEODIST city shanghai chongqing\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1447673.6920"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" GEORADIUS city "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" km\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chongqing"')]),s._v("\n")])])]),t("h2",{attrs:{id:"redis-事务操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-事务操作"}},[s._v("#")]),s._v(" Redis 事务操作")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_45408390/article/details/119731054",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis6 篇 （五）Redis 事务操作 + Redis 事务-秒杀案例"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"事务的概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务的概述"}},[s._v("#")]),s._v(" 事务的概述")]),s._v(" "),t("ul",[t("li",[s._v("Redis 事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。")]),s._v(" "),t("li",[s._v("事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。")])]),s._v(" "),t("h3",{attrs:{id:"multi、exec、discard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#multi、exec、discard"}},[s._v("#")]),s._v(" Multi、Exec、discard")]),s._v(" "),t("ul",[t("li",[s._v("从输入 Multi 命令开始，输入的命令都会依次进入命令队列中，但不会执行")]),s._v(" "),t("li",[s._v("直到输入 Exec 后，Redis 会将之前的命令队列中的命令依次执行")]),s._v(" "),t("li",[s._v("组队的过程中可以通过 discard")])]),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" flushdb\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 v1\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k2 v2\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SET k3 v3\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" del k1\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" del k2\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" del k3\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" discard "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# discard后上述命令全部失效")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" keys *\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k3"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k2"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k1"')]),s._v("\n")])])]),t("h3",{attrs:{id:"事务的错误处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务的错误处理"}},[s._v("#")]),s._v(" 事务的错误处理")]),s._v(" "),t("ul",[t("li",[s._v("组队中某个命令出现了报告错误，执行时整个的所有队列都会被取消")]),s._v(" "),t("li",[s._v("如果执行阶段某个命令报出了错误，则只有报错的命令不会被执行，而其他的命令都会执行，不会回滚。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" del k1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这句执行了")]),s._v("\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" del k2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这句执行了")]),s._v("\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" incr k3 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这句没执行")]),s._v("\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ERR value is not an integer or out of range\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" keys *\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k3"')]),s._v("\n")])])]),t("h3",{attrs:{id:"乐观锁-悲观锁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁-悲观锁"}},[s._v("#")]),s._v(" 乐观锁 & 悲观锁")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[s._v("乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量。Redis 就是利用这种 check-and-set 机制实现事务的。")])])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("ul",[t("li",[s._v("悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会 block 直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。")])])]),t("h3",{attrs:{id:"watch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#watch"}},[s._v("#")]),s._v(" WATCH")]),s._v(" "),t("ul",[t("li",[s._v("在执行 multi 之前，先执行 watch key1 [key2],可以监视一个(或多个) key")]),s._v(" "),t("li",[s._v("如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get k1\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"120"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" k1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监视 k1")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" incrby k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\nQUEUED\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("######### 另一个终端窗口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改了 k1")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#########")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在开启事务的时候，在执行前先修改一下信息，就会执行失败，这是watch key的作用")]),s._v("\n")])])]),t("h3",{attrs:{id:"unwatch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#unwatch"}},[s._v("#")]),s._v(" UNWATCH")]),s._v(" "),t("ul",[t("li",[s._v("取消 WATCH 命令对所有 key 的监视。")]),s._v(" "),t("li",[s._v("如果在执行 WATCH 命令之后，EXEC 命令或 DISCARD 命令先被执行了的话，那么就不需要再执行 UNWATCH 了")])]),s._v(" "),t("h2",{attrs:{id:"redis-持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-持久化"}},[s._v("#")]),s._v(" Redis 持久化")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_45408390/article/details/119731077",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis6 篇 （六）Redis 持久化"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("RDB = Redis Database = 在指定的时间间隔内将内存中的数据集快照 snapshot 写入到磁盘中")])]),s._v(" "),t("blockquote",[t("p",[s._v("AOF = Append Only File = 以日志形式记录每一个写操作（只许追加不可改写）")])]),s._v(" "),t("h3",{attrs:{id:"redis-持久化-aof-rdb-的区别和选择"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-持久化-aof-rdb-的区别和选择"}},[s._v("#")]),s._v(" Redis 持久化 AOF/ RDB 的区别和选择")]),s._v(" "),t("ol",[t("li",[s._v("RDB 持久化")])]),s._v(" "),t("ul",[t("li",[s._v("RDB 持久化是将 Redis 中的数据保存到磁盘中的一种方式。当配置了 RDB 持久化后，Redis 会定期将内存中的数据快照写入到磁盘中，形成一个 RDB 文件。RDB 文件是一个二进制文件，包含了 Redis 在某个时间点上的所有数据，可以用于恢复 Redis 的数据。")])]),s._v(" "),t("blockquote",[t("p",[s._v("RDB 持久化的优点是占用空间小，数据恢复速度快，适合于备份和灾难恢复。缺点是在持久化过程中可能会丢失一些数据，因为它只能定期将数据快照写入磁盘，如果在快照写入磁盘之前 Redis 发生了崩溃，那么内存中未保存到磁盘的数据将会丢失。")])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("AOF 持久化")])]),s._v(" "),t("ul",[t("li",[s._v("AOF 持久化是将 Redis 中的操作记录保存到磁盘中的一种方式。当配置了 AOF 持久化后，Redis 会将每个写入命令追加到一个文件中，称为 AOF 文件。AOF 文件是一个文本文件，包含了 Redis 所有的写入操作，可以用于恢复 Redis 的数据。")])]),s._v(" "),t("blockquote",[t("p",[s._v("AOF 持久化的优点是可以保证数据的完整性和一致性，因为它会记录每个写入操作。缺点是占用空间大，恢复速度较慢，适合于数据重要性较高的应用场景。另外，由于 AOF 文件中记录了所有的写入操作，如果写入操作非常频繁，AOF 文件可能会变得非常大，影响性能。")])]),s._v(" "),t("p",[t("strong",[s._v("综上所述，RDB 持久化适合于数据量较大、写入操作不频繁、数据恢复速度要求较高的场景，而 AOF 持久化适合于数据重要性较高、写入操作较为频繁的场景。可以根据实际的业务需求选择适合自己的持久化方式。")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("blockquote",[t("p",[s._v("官方推荐两个都启用。\n如果对数据不敏感，可以选单独用 RDB。不建议单独用 AOF，因为可能会出现 Bug。如果只是做纯内存缓存，可以都不用。")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("RDB 持久化方式能够在指定的时间间隔能对你的数据进行快照存储")])]),s._v(" "),t("li",[t("p",[s._v("AOF 持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF 命令以 redis 协议追加保存每次写的操作到文件末尾.")])]),s._v(" "),t("li",[t("p",[s._v("Redis 还能对 AOF 文件进行后台重写,使得 AOF 文件的体积不至于过大")])]),s._v(" "),t("li",[t("p",[s._v("如果你只希望你的数据在服务器运行的时候存在,你也可以不使用任何持久化方式.")])])])]),t("h3",{attrs:{id:"性能建议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#性能建议"}},[s._v("#")]),s._v(" 性能建议")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留save "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("这条规则。\n\n如果使用AOF，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了。\n\n代价,一是带来了持续的IO，二是AOF rewrite的最后将rewrite过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。\n\n只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上。\n\n默认超过原大小100%大小时重写可以改到适当的数值。\n\n————————————————\n版权声明：本文为CSDN博主「cv展示」的原创文章，遵循CC "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),s._v(" BY-SA版权协议，转载请附上原文出处链接及本声明。\n原文链接：https://blog.csdn.net/qq_45408390/article/details/119731077\n")])])]),t("h2",{attrs:{id:"redis-主从复制-redis-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-主从复制-redis-集群"}},[s._v("#")]),s._v(" Redis 主从复制 + Redis 集群")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_45408390/article/details/119731094",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis6 篇 （七）Redis 主从复制 + Redis 集群"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/super1223/article/details/119060113",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis.conf 原文件 + 配置详解"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/652465d11add436ea377bfe71c983b44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NDA4Mzkw,size_16,color_FFFFFF,t_70#pic_center",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"搭建主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建主从复制"}},[s._v("#")]),s._v(" 搭建主从复制")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/wq57885/article/details/121392104",target:"_blank",rel:"noopener noreferrer"}},[s._v("Error: No such file or directory @ rb_sysopen (缺少某库的解决方法)"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("brew install ca-certificates # 看报错，少什么brew\n")])])]),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/qianmaoliugou/p/15006539.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("mac brew 安装 redis (mac 本地安装 redis，便于操作)"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("brew install redis\n")])])]),t("hr"),s._v(" "),t("img",{staticStyle:{border:"2"},attrs:{src:"/img/redis-test.jpg"}}),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###################### redis6379.conf #######################")]),s._v("\ninclude myredis/redis.conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试中没使用绝对路径，否则前面增加‘/’")]),s._v("\npidfile /var/run/redis_6379.pid\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\ndbfilename dump6379.rdb\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###################### redis6380.conf #######################")]),s._v("\ninclude myredis/redis.conf\npidfile /var/run/redis_6380.pid\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v("\ndbfilename dump6380.rdb\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###################### redis6381.conf #######################")]),s._v("\ninclude myredis/redis.conf\npidfile /var/run/redis_6381.pid\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v("\ndbfilename dump6381.rdb\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("liuliyi@liuliyideMacBook-Pro redis-test % redis-server redis6379.conf\nliuliyi@liuliyideMacBook-Pro redis-test % redis-server redis6380.conf\nliuliyi@liuliyideMacBook-Pro redis-test % redis-server redis6381.conf\n\nliuliyi@liuliyideMacBook-Pro redis-test % "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("501")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8617")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":23下午 ??         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.63 /opt/homebrew/opt/redis/bin/redis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("501")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8685")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":30下午 ??         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.51 redis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6380\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("501")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8687")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":30下午 ??         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.50 redis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6381\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("501")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8841")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3363")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":32下午 ttys001    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n\nliuliyi@liuliyideMacBook-Pro redis-test % redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入指定端口的redis服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" info replication\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:master\nconnected_slaves:0 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 现在没有附属机")]),s._v("\nmaster_failover_state:no-failover\nmaster_replid:e44ac240b5de658e4541aa0bddf6645325214997\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:0\nsecond_repl_offset:-1\nrepl_backlog_active:0\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:0\nrepl_backlog_histlen:0\n\nliuliyi@liuliyideMacBook-Pro redis-test % redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" slaveof "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置主人为6379")]),s._v("\nOK\n\nliuliyi@liuliyideMacBook-Pro redis-test % redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" slaveof "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\nOK\n\nliuliyi@liuliyideMacBook-Pro redis-test % redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" info replication\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:master\nconnected_slaves:2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有两台从机了")]),s._v("\nslave0:ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1,port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v(",state"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(",lag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nslave1:ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1,port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v(",state"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(",lag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nmaster_failover_state:no-failover\nmaster_replid:0146ab97e819f0c04303677fc70f451a3f1aa244\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:28\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:28\n")])])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"},[s._v("Q & A")]),t("ul",[t("li",[s._v("从机会【全量】复制主机的内容")]),s._v(" "),t("li",[s._v("在主机上写，在从机上可以读取数据，在从机上写数据报错")]),s._v(" "),t("li",[s._v("主机挂掉，重启就行，一切如初，从机重启需重设：slaveof 127.0.0.1 6379")]),s._v(" "),t("li",[s._v("主机 shutdown 后，从机原地待命，等待主机重新启动，一切回复正常")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("复制原理")]),t("ul",[t("li",[s._v("Slave 启动成功连接到 master 后会发送一个 sync 命令")]),s._v(" "),t("li",[s._v("Master 接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master 将传送整个数据文件到 slave,以完成一次完全同步")]),s._v(" "),t("li",[s._v("全量复制：而 slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。")]),s._v(" "),t("li",[s._v("增量复制：Master 继续将新的所有收集到的修改命令依次传给 slave,完成同步")]),s._v(" "),t("li",[s._v("但是只要是重新连接 master,一次完全同步（全量复制)将被自动执行")])])]),t("h3",{attrs:{id:"反客为主"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反客为主"}},[s._v("#")]),s._v(" 反客为主")]),s._v(" "),t("blockquote",[t("p",[s._v("从机也可以有从机，还可以在主机挂掉的时候反客为主")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("slaveof no one "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 反客为主")]),s._v("\n")])])]),t("h3",{attrs:{id:"哨兵模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#哨兵模式"}},[s._v("#")]),s._v(" 哨兵模式")]),s._v(" "),t("blockquote",[t("p",[s._v("反客为主的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库")])]),s._v(" "),t("blockquote",[t("p",[s._v("先搭建一主二从的环境，自定义的/myredis 目录下新建 sentinel.conf 文件")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###################### sentinel.conf #######################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中mymaster为监控对象起的服务器名称， 1 为至少有多少个哨兵同意迁移的数量。")]),s._v("\nsentinel monitor mymaster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/06d6391b367d46309376900f9962e3cc.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NDA4Mzkw,size_16,color_FFFFFF,t_70#pic_center",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"redis-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-集群"}},[s._v("#")]),s._v(" Redis 集群")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"},[s._v("集群之前遇到的问题")]),t("ol",[t("li",[s._v("容量不够，redis 如何进行扩容？")]),s._v(" "),t("li",[s._v("并发写操作， redis 如何分摊？")]),s._v(" "),t("li",[s._v("主从模式，薪火相传模式，主机宕机，导致 ip 地址发生变化，应用程序中配置需要修改对应的主机地址、端口等信息。")])]),s._v(" "),t("p",[s._v("redis3.0 中提供了解决方案。就是无中心化集群配置。")])]),t("h3",{attrs:{id:"集群概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群概述"}},[s._v("#")]),s._v(" 集群概述")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Redis 集群实现了对 Redis 的水平扩容")])]),s._v(" "),t("li",[t("p",[s._v("即启动 N 个 redis 节点，将整个数据库分布存储在这 N 个节点中，每个节点存储总数据的 1/N。")])]),s._v(" "),t("li",[t("p",[s._v("Redis 集群通过分区（partition）来提供一定程度的可用性（availability）")])]),s._v(" "),t("li",[t("p",[s._v("即使集群中有一部分节点失效或者无法进行通讯， 集群也可以继续处理命令请求。")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/a119e8e84725496b9cc8022f62f98260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NDA4Mzkw,size_16,color_FFFFFF,t_70#pic_center",alt:"img"}})]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"title"},[s._v("总结：Redis 部署的四种模式")]),t("ol",[t("li",[s._v("单机模式 💻")]),s._v(" "),t("li",[s._v("主从模式 💻 - 💻 - 💻")]),s._v(" "),t("li",[s._v("哨兵模式 🪖 - ?>> 💻")]),s._v(" "),t("li",[s._v("集群模式 💻💻💻💻💻💻 !>> 💻")])])]),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_45408390/article/details/119731094",target:"_blank",rel:"noopener noreferrer"}},[s._v("具体命令点击查看，没往下写了"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);