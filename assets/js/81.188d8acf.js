(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{501:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"nginx-部署记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-部署记录"}},[t._v("#")]),t._v(" nginx 部署记录")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx -v")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx version: nginx/1.18.0 (Ubuntu) 老版本")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/nginx/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx目录在此")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"/img/ls.png",alt:"img"}})]),t._v(" "),s("blockquote",[s("p",[t._v("查看 主配置文件 nginx.conf")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("user www-data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes auto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid /run/nginx.pid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ninclude /etc/nginx/modules-enabled/*.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        worker_connections "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("768")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# multi_accept on;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 省略...")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Virtual Host Configs")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##")]),t._v("\n\n        include /etc/nginx/conf.d/*.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里有两个include目录,第一个是conf.d下的所有conf配置文件")]),t._v("\n        include /etc/nginx/sites-enabled/*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第二个是sites-enabled 下的所有文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("blockquote",[s("p",[t._v("进入 conf.d 目录创建自定义配置文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" conf.d/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" default.conf "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# touch 是新建文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" default.conf\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# default.conf")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        root /app/health"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass http://127.0.0.1:19008/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v("\nnginx: the configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/nginx/nginx.conf syntax is ok\n")])])]),s("h2",{attrs:{id:"space365-项目部署记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#space365-项目部署记录"}},[t._v("#")]),t._v(" space365 项目部署记录")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("拉取项目，切换到对应分支")])]),t._v(" "),s("li",[s("p",[t._v("运行打包命令，输出到/dist 目录下")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("配置 ecosystem.config.js ，pm2 可以配置文件与项目分离，并采用 cluster 模式部署")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("apps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s365-health"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("instances")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("instance_var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSTANCE_ID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autorestart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("max_restarts")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("restartDelay")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("watch")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ignore_watch")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node_modules"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uploads"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"logs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("max_memory_restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3G"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEBUG")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_CONFIG_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/s365-health"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置文件需要部署/复制到这个目录")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("回到项目目录,进入/dist目录")])]),t._v(" "),s("blockquote",[s("p",[t._v("space365总是运行webpack打包后的文件...")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pm2 list\n\n┌─────┬────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐\n│ id  │ name           │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │\n├─────┼────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤\n│ 0   │ index          │ default     │ 1.0.0   │ fork    │ 902      │ 24D    │ 0    │ online    │ 0%       │ 78.2mb   │ root     │ disabled │\n│ 1   │ s365-health    │ default     │ 1.0.0   │ cluster │ 1750132  │ 47h    │ 30   │ online    │ 0%       │ 143.9mb  │ root     │ disabled │\n└─────┴────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘\n\npm2 start/restart 1  // cluster 部署\npm2 start src/index.js // fork 部署\n")])])]),s("h2",{attrs:{id:"docker-本地打包并推送到阿里云"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-本地打包并推送到阿里云"}},[t._v("#")]),t._v(" docker 本地打包并推送到阿里云")]),t._v(" "),s("h3",{attrs:{id:"_1-项目根目录下准备dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-项目根目录下准备dockerfile"}},[t._v("#")]),t._v(" 1. 项目根目录下准备Dockerfile")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Dockerfile demo")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" node:lts")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" NODE_ENV=production "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    PORT=19008")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /backend")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./dist /backend")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" npm install yarn --registry https://registry.npm.taobao.org/; "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    yarn --registry https://registry.npm.taobao.org/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PORT")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" [ "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./bundle.js"')]),t._v(" ]")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-docker-build"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-build"}},[t._v("#")]),t._v(" 2.  docker build")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/buildx/working-with-buildx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Buildx | Docker Documentation"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("gulp build "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先自己把项目打包了")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 然后用 docker 打包成本地镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" buildx build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--platform")]),t._v(" linux/amd64 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" s365-bytedance-apps:x.x.x "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker buildx build --platform linux/amd64 -t registry.cn-shanghai.aliyuncs.com/space365/s365-bytedance-apps:x.x.x .")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打包好了，本地就能看到")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-本地镜像-push-到云端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-本地镜像-push-到云端"}},[t._v("#")]),t._v(" 3. 本地镜像 push 到云端")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" login registry.cn-shanghai.aliyuncs.com "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--username")]),t._v(" xxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--password")]),t._v(" xxxxx\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("imageId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" registry.cn-shanghai.aliyuncs.com/xxx/xxx-xxx:x.x.x\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push registry.cn-shanghai.aliyuncs.com/xxx/xxx-xxx:x.x.x\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" save "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v("  s365-xxx-backend.tar  s365-xxx-backend:x.x.x\n\n")])])]),s("p",[s("a",{attrs:{href:"https://www.runoob.com/linux/linux-comm-scp.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux scp命令"),s("OutboundLink")],1)]),t._v(" "),s("blockquote",[s("p",[t._v("scp 是 secure copy 的缩写, scp 是 linux 系统下基于 ssh 登陆进行安全的远程文件拷贝命令。")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp [可选参数] file_source file_target ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" docker-deploy root@"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":/home/xxx/\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" docker-deploy\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s操作,注意缩进2个空格")]),t._v("\nkubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" xxx.yaml\nkubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" space365-xxx get configmap\n\nkubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" xxx.yaml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 命名空间中创建仓库key，并在deployment.yaml中加入")]),t._v("\nimagePullSecrets:\n        - name: xxx\n\nkubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" xxx-xxx get pod\nkubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" xxx-xxx describe pod backend-xxxxx-xxxx\nkubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" deployment.yaml\nkubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" xxx-xxx logs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" backend-xxxxx-xxxx\nkubectl replace "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--force")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" deployment.yaml\n")])])]),s("h2",{attrs:{id:"docker-部署实战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-部署实战"}},[t._v("#")]),t._v(" docker 部署实战")]),t._v(" "),s("blockquote",[s("p",[t._v("2022/7/18 Work Note From Cwj")])]),t._v(" "),s("div",{staticClass:"custom-block right"},[s("p",[t._v("Goto his blog >> "),s("a",{attrs:{href:"https://github.com/CanMusic/me/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("CanMusic"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[t._v("前置条件：本地已docker build，docker login后推送到云端")])]),s("h4",{attrs:{id:"_1-进入到-docker-compose-yaml的目录下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-进入到-docker-compose-yaml的目录下"}},[t._v("#")]),t._v(" 1. 进入到 docker-compose.yaml的目录下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("root@space-node2:/home/xxxxxx/space365 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\napp.conf  conf/  docker-compose.yaml  log/  nginx.conf\n\nroot@space-node2:/home/xxxxxx/space365 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" docker-compose.yaml \n")])])]),s("h4",{attrs:{id:"_2-停止原有容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-停止原有容器"}},[t._v("#")]),t._v(" 2. 停止原有容器")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("root@space-node2:/home/xxxxxx/space365 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose stop health\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1\n ⠿ Container health2  Stopped                                                                                                                                                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".4s\n\nroot@space-node2:/home/xxxxxx/space365 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose stop health1\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1\n ⠿ Container health3  Stopped                                                                                                                                                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".3s\n\nroot@space-node2:/home/xxxxxx/space365 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" health\n\nGoing to remove health2\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/0\n ⠿ Container health2  Removed                                                                                                                                                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n\nroot@space-node2:/home/xxxxxx/space365 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" health1\nGoing to remove health3\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/0\n ⠿ Container health3  Removed                                                                                                                                                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n")])])]),s("h4",{attrs:{id:"_3-更新容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-更新容器"}},[t._v("#")]),t._v(" 3. 更新容器")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("root@space-node2:/home/shgbit/space365"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker compose up health -d")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("/13\n ⠿ health           complete                                                                                                                                                                     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(".1s\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1\n ⠿ Container health2  Started                                                                                                                                                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".9s\n \nroot@space-node2:/home/shgbit/space365"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker compose up health1 -d")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1\n ⠿ Container health3  Started                                                                                                                                                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".4s\nroot@space-node2:/home/shgbit/space365"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker ps ")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);