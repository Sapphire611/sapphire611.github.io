(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{459:function(a,t,s){"use strict";s.r(t);var e=s(1),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"mongodb-不能裸奔"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-不能裸奔"}},[a._v("#")]),a._v(" Mongodb 不能裸奔")]),a._v(" "),t("blockquote",[t("p",[a._v("某次工作途中测试服务器的mongodb没有上密码，直接被人清库了两次，特此记录")])]),a._v(" "),t("h3",{attrs:{id:"基于-docker-给-mongodb-增加密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于-docker-给-mongodb-增加密码"}},[a._v("#")]),a._v(" 基于 docker 给 mongodb 增加密码")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker run --name mongo -d -p 27017:27017 --restart always mongo --auth # 利用docker挂载mongo，顺便设置自启动\ndocker ps\ndocker exec -it [container_id] mongo admin\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('MongoDB shell version v5.0.6\nconnecting to: mongodb://127.0.0.1:27017/admin?compressors=disabled&gssapiServiceName=mongodb\nImplicit session: session { "id" : UUID("a9721af9-51b8-4771-ba38-20396ca807a9") }\nMongoDB server version: 5.0.6\n================\nWarning: the "mongo" shell has been superseded by "mongosh",\nwhich delivers improved usability and compatibility.The "mongo" shell has been deprecated and will be removed in\nan upcoming release.\nFor installation instructions, see\nhttps://docs.mongodb.com/mongodb-shell/install/\n================\n\n> db.createUser({ user: \'root\', pwd: \'root\', roles: [ { role: "userAdminAnyDatabase", db: "admin" } ] });\n\nSuccessfully added user: {\n\t"user" : "root",\n\t"roles" : [\n\t\t{\n\t\t\t"role" : "userAdminAnyDatabase",\n\t\t\t"db" : "admin"\n\t\t}\n\t]\n}\n\n> exit\nbye\n')])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[a._v("其实到这一步，就可以了，不一定要针对单数据库创建特定的管理员，用一个就行")])]),t("hr"),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 更新权限")]),a._v("\ndb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[a._v("roles")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" \n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"role"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"userAdminAnyDatabase"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"db"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"role"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"dbOwner"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"db"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"role"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"clusterAdmin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"db"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n             "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 授予备份，恢复数据权限")]),a._v("\ndb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grantRolesToUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[a._v("role")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("”backup”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[a._v("db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\ndb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grantRolesToUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[a._v("role")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"restore"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[a._v("db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("hr"),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# mongodb链接url\n\ndb: mongodb://[username]:[password]@[ip]:[port]/[dbName]?readPreference=primary&directConnection=true&ssl=false&authMechanism=DEFAULT&authSource=admin\n\n# authSource=admin 一定要加\n")])])]),t("hr"),a._v(" "),t("h3",{attrs:{id:"mongodump-mongorestore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodump-mongorestore"}},[a._v("#")]),a._v(" Mongodump & Mongorestore")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://juejin.cn/post/7036272188915187742",target:"_blank",rel:"noopener noreferrer"}},[a._v("如何使用mongodump"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[a._v("mongodb将主体与插件进行了分离，需要额外下载插件包MongoDB Database Tools 下载地址: "),t("a",{attrs:{href:"https://www.mongodb.com/try/download/database-tools",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载地址"),t("OutboundLink")],1)])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" mongodb.tools.xxxxxxx.tgz "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压")]),a._v("\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /bin "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压后进入 /bin 目录")]),a._v("\n./mongodump\n./mongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--forceTableScan")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("database_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 因mongodb版本不一致导致的导出失败解决方案:")]),a._v("\n./mongorestore\n")])])]),t("h3",{attrs:{id:"对应mongo库打包成gz"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对应mongo库打包成gz"}},[a._v("#")]),a._v(" 对应mongo库打包成gz")]),a._v(" "),t("h4",{attrs:{id:"mongodump"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodump"}},[a._v("#")]),a._v(" mongodump")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("mongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:27017 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("database_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gzip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--archive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxx.gz "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 无密码")]),a._v("\nmongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:27017 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--authenticationDatabase")]),a._v(" admin "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("database_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gzip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--archive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxx.gz "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#有密码")]),a._v("\n")])])]),t("h4",{attrs:{id:"mongorestore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongorestore"}},[a._v("#")]),a._v(" mongorestore")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("mongorestore "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:27017 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("database_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gzip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--archive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxx.gz "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 无密码")]),a._v("\nmongorestore "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:27017 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--authenticationDatabase")]),a._v(" admin "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("database_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gzip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--archive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxx.gz "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#有密码")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);