(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{468:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"ğŸ‘‹-node-js-é¢˜ç›®æ•´ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ‘‹-node-js-é¢˜ç›®æ•´ç†"}},[t._v("#")]),t._v(" ğŸ‘‹  Node.js é¢˜ç›®æ•´ç†")]),t._v(" "),s("div",{staticClass:"custom-block right"},[s("p",[t._v("æ¥è‡ª "),s("a",{attrs:{href:"http://sapphire611.github.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Sapphire611"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"_1-koa-å’Œ-express-æœ‰å“ªäº›ä¸åŒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-koa-å’Œ-express-æœ‰å“ªäº›ä¸åŒ"}},[t._v("#")]),t._v(" 1. Koa å’Œ Express æœ‰å“ªäº›ä¸åŒï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("expressæ¡†æ¶æ˜¯ä¸€ä¸ªåŸºäº Node.js å¹³å°çš„æç®€ã€çµæ´»çš„ web åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œ")])]),t._v(" "),s("blockquote",[s("p",[t._v("koaæ˜¯ Express åŸç­äººé©¬åŸºäº ES6 æ–°ç‰¹æ€§é‡æ–°å¼€å‘çš„æ¡†æ¶,æ¡†æ¶è‡ªèº«ä¸åŒ…å«ä»»ä½•ä¸­é—´ä»¶ï¼Œå¾ˆå¤šåŠŸèƒ½éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶è§£å†³")])]),t._v(" "),s("ul",[s("li",[t._v('ç”±äºå…¶åŸºäº ES6 generator ç‰¹æ€§çš„å¼‚æ­¥æµç¨‹æ§åˆ¶ï¼Œè§£å†³äº† "callback hell" å’Œéº»çƒ¦çš„é”™è¯¯å¤„ç†é—®é¢˜ã€‚')])]),t._v(" "),s("ol",[s("li",[t._v("expresså†…ç½®äº†è®¸å¤šä¸­é—´ä»¶ & æ¨¡å—å¯ä¾›ä½¿ç”¨ï¼Œè€Œkoaæ²¡æœ‰ã€‚")])]),t._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[t._v("2. expressçš„ä¸­é—´ä»¶æ¨¡å‹ä¸ºçº¿å‹ï¼Œè€Œkoaçš„ä¸­é—´ä»¶æ¨¡å‹ä¸ºUå‹ï¼Œä¹Ÿå¯ç§°ä¸ºæ´‹è‘±æ¨¡å‹æ„é€ ä¸­é—´ä»¶ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("Express\nä¼˜ç‚¹ï¼šçº¿æ€§é€»è¾‘ï¼Œå¯ç”¨æ¨¡å—ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒ\nç¼ºç‚¹ï¼šcallback.hell")])]),t._v(" "),s("blockquote",[s("p",[t._v("Koa\nä¼˜ç‚¹ï¼šğŸ§…ï¼Œè§£å†³äº†callback hellï¼Œè½»é‡\nç¼ºç‚¹ï¼šç¤¾åŒºç›¸å¯¹è¾ƒå°ã€‚")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_3-æµè§ˆå™¨å’Œ-node-ä¸­-äº‹ä»¶å¾ªç¯æœ‰ä»€ä¹ˆåŒºåˆ«"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-æµè§ˆå™¨å’Œ-node-ä¸­-äº‹ä»¶å¾ªç¯æœ‰ä»€ä¹ˆåŒºåˆ«"}},[t._v("#")]),t._v(" 3. æµè§ˆå™¨å’Œ Node ä¸­ äº‹ä»¶å¾ªç¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("æµè§ˆå™¨å’Œ Node.js éƒ½å®ç°äº†äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼Œä½†å®ƒä»¬çš„å®ç°æœºåˆ¶å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼š")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("ç‰¹æ€§")])]),t._v(" "),s("th",[s("strong",[t._v("æµè§ˆå™¨äº‹ä»¶å¾ªç¯")])]),t._v(" "),s("th",[s("strong",[t._v("Node.js äº‹ä»¶å¾ªç¯")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("è¿è¡Œç¯å¢ƒ")])]),t._v(" "),s("td",[t._v("åŸºäº Web APIsï¼ˆå¦‚ "),s("code",[t._v("setTimeout")]),t._v("ã€DOM äº‹ä»¶ï¼‰ï¼Œç”±æµè§ˆå™¨å¼•æ“ï¼ˆå¦‚ V8 + Blinkï¼‰å®ç°ã€‚")]),t._v(" "),s("td",[t._v("åŸºäº libuv åº“ï¼Œæä¾›éé˜»å¡ I/Oï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œæ“ä½œï¼‰ï¼Œä¸æ¶‰åŠ DOMã€‚")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("äº‹ä»¶å¾ªç¯é˜¶æ®µ")])]),t._v(" "),s("td",[t._v("åˆ†ä¸ºå®ä»»åŠ¡ï¼ˆMacro Taskï¼‰å’Œå¾®ä»»åŠ¡ï¼ˆMicro Taskï¼‰ï¼Œæ¯æ¬¡å¾ªç¯å¤„ç†ä¸€ä¸ªå®ä»»åŠ¡åæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚")]),t._v(" "),s("td",[t._v("åˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼ˆTimersã€Pendingã€Pollã€Checkã€Close ç­‰ï¼‰ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œæ¯ä¸ªé˜¶æ®µçš„ä»»åŠ¡ã€‚")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("å¾®ä»»åŠ¡æ‰§è¡Œæ—¶æœº")])]),t._v(" "),s("td",[t._v("åœ¨æ¯ä¸ªå®ä»»åŠ¡æ‰§è¡Œåç«‹å³æ‰§è¡Œï¼ˆå¦‚ "),s("code",[t._v("Promise.then")]),t._v("ï¼‰ã€‚")]),t._v(" "),s("td",[t._v("åœ¨äº‹ä»¶å¾ªç¯é˜¶æ®µåˆ‡æ¢ä¹‹é—´æ‰§è¡Œï¼ˆNode.js v11+ åè¡Œä¸ºä¸æµè§ˆå™¨ä¸€è‡´ï¼‰ã€‚")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("ç‰¹æœ‰ API")])]),t._v(" "),s("td",[s("code",[t._v("requestAnimationFrame")]),t._v("ã€"),s("code",[t._v("MutationObserver")]),t._v("ã€‚")]),t._v(" "),s("td",[s("code",[t._v("setImmediate")]),t._v("ï¼ˆCheck é˜¶æ®µï¼‰ã€"),s("code",[t._v("process.nextTick")]),t._v("ï¼ˆå½“å‰æ“ä½œåç«‹å³æ‰§è¡Œï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼‰ã€‚")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("I/O å¤„ç†")])]),t._v(" "),s("td",[t._v("ç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰ï¼Œä¾èµ– Web APIsã€‚")]),t._v(" "),s("td",[t._v("ç³»ç»Ÿçº§ I/Oï¼ˆæ–‡ä»¶ã€ç½‘ç»œç­‰ï¼‰ï¼Œä¾èµ– libuv çš„çº¿ç¨‹æ± å’Œäº‹ä»¶é©±åŠ¨ã€‚")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("setTimeout(() => console.log('timeout'), 0);")]),t._v(" "),s("td",[t._v("setTimeout(() => console.log('timeout'), 0);")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Promise.resolve().then(() => console.log('promise'));")]),t._v(" "),s("td",[t._v("setImmediate(() => console.log('immediate'));")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("// è¾“å‡ºé¡ºåºï¼špromise â†’ timeout")]),t._v(" "),s("td",[t._v("// è¾“å‡ºé¡ºåºå¯èƒ½éšæœºï¼ˆå–å†³äºäº‹ä»¶å¾ªç¯å¯åŠ¨æ—¶é—´ï¼‰")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("å…³é”®å·®å¼‚æ€»ç»“")])]),t._v(" "),s("td",[t._v("å¾®ä»»åŠ¡ä¼˜å…ˆçº§é«˜ï¼Œä¸ UI æ¸²æŸ“ç´§å¯†å…³è”ã€‚")]),t._v(" "),s("td",[t._v("å¤šé˜¶æ®µå¤„ç†å¤æ‚ I/Oï¼Œ"),s("code",[t._v("nextTick")]),t._v(" å’Œ "),s("code",[t._v("setImmediate")]),t._v(" æ˜¯ç‰¹æœ‰æœºåˆ¶ã€‚")])])])]),t._v(" "),s("h3",{attrs:{id:"_3-1-è¿è¡Œç¯å¢ƒä¸èŒè´£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-è¿è¡Œç¯å¢ƒä¸èŒè´£"}},[t._v("#")]),t._v(" 3.1. è¿è¡Œç¯å¢ƒä¸èŒè´£")]),t._v(" "),s("p",[t._v("æµè§ˆå™¨ï¼šå¤„ç† DOM äº‹ä»¶ã€UI æ¸²æŸ“ã€ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚ fetchï¼‰ã€ç”¨æˆ·äº¤äº’ï¼ˆå¦‚ç‚¹å‡»ï¼‰ç­‰ã€‚")]),t._v(" "),s("p",[t._v("Node.jsï¼šå¤„ç†æ–‡ä»¶ I/Oã€ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚ http æ¨¡å—ï¼‰ã€å­è¿›ç¨‹ç­‰ç³»ç»Ÿçº§æ“ä½œã€‚")]),t._v(" "),s("h3",{attrs:{id:"_3-2-äº‹ä»¶å¾ªç¯çš„é˜¶æ®µ-phases"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-äº‹ä»¶å¾ªç¯çš„é˜¶æ®µ-phases"}},[t._v("#")]),t._v(" 3.2. äº‹ä»¶å¾ªç¯çš„é˜¶æ®µï¼ˆPhasesï¼‰")]),t._v(" "),s("h4",{attrs:{id:"æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯"}},[t._v("#")]),t._v(" æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯")]),t._v(" "),s("blockquote",[s("p",[t._v("åŸºäº HTML5 è§„èŒƒï¼Œåˆ†ä¸ºå®ä»»åŠ¡ï¼ˆMacro Taskï¼‰å’Œå¾®ä»»åŠ¡ï¼ˆMicro Taskï¼‰ï¼š")])]),t._v(" "),s("p",[t._v("å®ä»»åŠ¡ï¼šåŒ…æ‹¬ scriptï¼ˆæ•´ä½“ä»£ç ï¼‰ã€setTimeoutã€setIntervalã€I/Oã€UI æ¸²æŸ“ã€postMessage ç­‰ã€‚")]),t._v(" "),s("p",[t._v("å¾®ä»»åŠ¡ï¼šåŒ…æ‹¬ Promise.thenã€MutationObserverã€queueMicrotask ç­‰ã€‚")]),t._v(" "),s("p",[t._v("æ‰§è¡Œé¡ºåºï¼š")]),t._v(" "),s("p",[t._v("æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ â†’ æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ— â†’ æ¸²æŸ“ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰â†’ ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"node-js-çš„äº‹ä»¶å¾ªç¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-js-çš„äº‹ä»¶å¾ªç¯"}},[t._v("#")]),t._v(" Node.js çš„äº‹ä»¶å¾ªç¯")]),t._v(" "),s("p",[t._v("åŸºäº libuv åº“ï¼Œåˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰ï¼š")]),t._v(" "),s("p",[t._v("Timersï¼šæ‰§è¡Œ setTimeout å’Œ setInterval çš„å›è°ƒã€‚")]),t._v(" "),s("p",[t._v("Pending Callbacksï¼šå¤„ç†ç³»ç»Ÿæ“ä½œï¼ˆå¦‚ TCP é”™è¯¯ï¼‰çš„å›è°ƒã€‚")]),t._v(" "),s("p",[t._v("Idle/Prepareï¼šå†…éƒ¨ä½¿ç”¨ï¼ˆå¯å¿½ç•¥ï¼‰ã€‚")]),t._v(" "),s("p",[t._v("Pollï¼šæ£€ç´¢æ–°çš„ I/O äº‹ä»¶ï¼Œæ‰§è¡Œ I/O å›è°ƒï¼ˆå¦‚æ–‡ä»¶è¯»å–ã€ç½‘ç»œè¯·æ±‚ï¼‰ã€‚")]),t._v(" "),s("p",[t._v("Checkï¼šæ‰§è¡Œ setImmediate çš„å›è°ƒã€‚")]),t._v(" "),s("p",[t._v("Close Callbacksï¼šå¤„ç†å…³é—­äº‹ä»¶çš„å›è°ƒï¼ˆå¦‚ socket.on('close')ï¼‰ã€‚")]),t._v(" "),s("p",[t._v("å¾®ä»»åŠ¡ï¼ˆPromise.thenã€process.nextTickï¼‰ï¼š")]),t._v(" "),s("p",[t._v("process.nextTick åœ¨é˜¶æ®µåˆ‡æ¢å‰ä¼˜å…ˆæ‰§è¡Œï¼ˆä¼˜å…ˆçº§é«˜äºå¾®ä»»åŠ¡ï¼‰ã€‚")]),t._v(" "),s("h2",{attrs:{id:"å¦‚ä½•å®ç°jwté‰´æƒæœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•å®ç°jwté‰´æƒæœºåˆ¶"}},[t._v("#")]),t._v(" å¦‚ä½•å®ç°JWTé‰´æƒæœºåˆ¶ï¼Ÿ")]),t._v(" "),s("h3",{attrs:{id:"jwtæ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jwtæ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" JWTæ˜¯ä»€ä¹ˆ")]),t._v(" "),s("p",[t._v("JWTï¼ˆJSON Web Tokenï¼‰åˆ†æˆäº†ä¸‰éƒ¨åˆ†ï¼Œå¤´éƒ¨ï¼ˆHeaderï¼‰ã€è½½è·ï¼ˆPayloadï¼‰ã€ç­¾åï¼ˆSignatureï¼‰ï¼Œå¹¶ä»¥.è¿›è¡Œæ‹¼æ¥ã€‚å…¶ä¸­å¤´éƒ¨å’Œè½½è·éƒ½æ˜¯ä»¥JSONæ ¼å¼å­˜æ”¾æ•°æ®ï¼Œåªæ˜¯è¿›è¡Œäº†ç¼–ç ")]),t._v(" "),s("ol",[s("li",[t._v("header\næ¯ä¸ªJWTéƒ½ä¼šå¸¦æœ‰å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™é‡Œä¸»è¦å£°æ˜ä½¿ç”¨çš„ç®—æ³•ã€‚å£°æ˜ç®—æ³•çš„å­—æ®µåä¸ºalgï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªtypçš„å­—æ®µï¼Œé»˜è®¤JWTå³å¯ã€‚ä»¥ä¸‹ç¤ºä¾‹ä¸­ç®—æ³•ä¸ºHS256")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"alg"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HS256"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"typ"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JWT"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),s("ul",[s("li",[t._v("å› ä¸ºJWTæ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¯¹ä»¥ä¸Šå†…å®¹è¿›è¡ŒBase64ç¼–ç ï¼Œç¼–ç åå­—ç¬¦ä¸²å¦‚ä¸‹ï¼š")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9        \n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("payload")])]),t._v(" "),s("p",[t._v("è½½è·å³æ¶ˆæ¯ä½“ï¼Œè¿™é‡Œä¼šå­˜æ”¾å®é™…çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯Tokençš„æ•°æ®å£°æ˜ï¼Œä¾‹å¦‚ç”¨æˆ·çš„idå’Œnameï¼Œé»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¼šæºå¸¦ä»¤ç‰Œçš„ç­¾å‘æ—¶é—´iatï¼Œé€šè¿‡è¿˜å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"sub"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1234567890"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"John Doe"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"iat"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1516239022")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("åŒæ ·è¿›è¡ŒBase64ç¼–ç åï¼Œå­—ç¬¦ä¸²å¦‚ä¸‹ï¼š")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("Signature")])]),t._v(" "),s("p",[t._v("ç­¾åæ˜¯å¯¹å¤´éƒ¨å’Œè½½è·å†…å®¹è¿›è¡Œç­¾åï¼Œä¸€èˆ¬æƒ…å†µï¼Œè®¾ç½®ä¸€ä¸ªsecretKeyï¼Œå¯¹å‰ä¸¤ä¸ªçš„ç»“æœè¿›è¡ŒHMACSHA25ç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š")]),t._v(" "),s("blockquote",[s("p",[t._v("Signature = HMACSHA256(base64Url(header)+.+base64Url(payload),secretKey)")])]),t._v(" "),s("p",[t._v("ä¸€æ—¦å‰é¢ä¸¤éƒ¨åˆ†æ•°æ®è¢«ç¯¡æ”¹ï¼Œåªè¦æœåŠ¡å™¨åŠ å¯†ç”¨çš„å¯†é’¥æ²¡æœ‰æ³„éœ²ï¼Œå¾—åˆ°çš„ç­¾åè‚¯å®šå’Œä¹‹å‰çš„ç­¾åä¸ä¸€è‡´")]),t._v(" "),s("h3",{attrs:{id:"å¦‚ä½•å®ç°jwt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•å®ç°jwt"}},[t._v("#")]),t._v(" å¦‚ä½•å®ç°JWT")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("Tokençš„ä½¿ç”¨åˆ†æˆäº†ä¸¤éƒ¨åˆ†ï¼š\n\nç”Ÿæˆtokenï¼šç™»å½•æˆåŠŸçš„æ—¶å€™ï¼Œé¢å‘token\néªŒè¯tokenï¼šè®¿é—®æŸäº›èµ„æºæˆ–è€…æ¥å£æ—¶ï¼ŒéªŒè¯token\nç”Ÿæˆ token\nå€ŸåŠ©ç¬¬ä¸‰æ–¹åº“jsonwebtokenï¼Œé€šè¿‡jsonwebtoken çš„ sign æ–¹æ³•ç”Ÿæˆä¸€ä¸ª tokenï¼š\n\nç¬¬ä¸€ä¸ªå‚æ•°æŒ‡çš„æ˜¯ Payload\n\nç¬¬äºŒä¸ªæ˜¯ç§˜é’¥ï¼ŒæœåŠ¡ç«¯ç‰¹æœ‰\n\nç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ optionï¼Œå¯ä»¥å®šä¹‰ token è¿‡æœŸæ—¶é—´\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" moment "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'moment'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" jwt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsonwebtoken'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\njwt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sign")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// option :{ expiresIn: moment().add(1, 'days').valueOf() }")]),t._v("\n")])])]),s("ul",[s("li",[t._v("åœ¨å‰ç«¯æ¥æ”¶åˆ°tokenåï¼Œä¸€èˆ¬æƒ…å†µä¼šé€šè¿‡localStorageè¿›è¡Œç¼“å­˜ï¼Œç„¶åå°†tokenæ”¾åˆ°HTTPè¯·æ±‚å¤´Authorization ä¸­ï¼Œå…³äºAuthorizationçš„è®¾ç½®ï¼Œå‰é¢è¦åŠ ä¸Š Bearer ï¼Œæ³¨æ„åé¢å¸¦æœ‰ç©ºæ ¼")])]),t._v(" "),s("h3",{attrs:{id:"æ ¡éªŒtoken"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ ¡éªŒtoken"}},[t._v("#")]),t._v(" æ ¡éªŒtoken")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" jwt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsonwebtoken'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" jwt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"ä¼˜ç¼ºç‚¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜ç¼ºç‚¹"}},[t._v("#")]),t._v(" ä¼˜ç¼ºç‚¹")]),t._v(" "),s("p",[t._v("ä¼˜ç‚¹ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("jsonå…·æœ‰é€šç”¨æ€§ï¼Œæ‰€ä»¥å¯ä»¥è·¨è¯­è¨€")])]),t._v(" "),s("li",[s("p",[t._v("ç»„æˆç®€å•ï¼Œå­—èŠ‚å ç”¨å°ï¼Œä¾¿äºä¼ è¾“")])]),t._v(" "),s("li",[s("p",[t._v("æœåŠ¡ç«¯æ— éœ€ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œå¾ˆå®¹æ˜“è¿›è¡Œæ°´å¹³æ‰©å±•")])]),t._v(" "),s("li",[s("p",[t._v("ä¸€å¤„ç”Ÿæˆï¼Œå¤šå¤„ä½¿ç”¨ï¼Œå¯ä»¥åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè§£å†³å•ç‚¹ç™»å½•é—®é¢˜")])]),t._v(" "),s("li",[s("p",[t._v("å¯é˜²æŠ¤CSRFæ”»å‡»")])])]),t._v(" "),s("p",[t._v("ç¼ºç‚¹ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("payloadéƒ¨åˆ†ä»…ä»…æ˜¯è¿›è¡Œç®€å•ç¼–ç ï¼Œæ‰€ä»¥åªèƒ½ç”¨äºå­˜å‚¨é€»è¾‘å¿…éœ€çš„éæ•æ„Ÿä¿¡æ¯")])]),t._v(" "),s("li",[s("p",[t._v("éœ€è¦ä¿æŠ¤å¥½åŠ å¯†å¯†é’¥ï¼Œä¸€æ—¦æ³„éœ²åæœä¸å ªè®¾æƒ³")])]),t._v(" "),s("li",[s("p",[t._v("ä¸ºé¿å…tokenè¢«åŠ«æŒï¼Œæœ€å¥½ä½¿ç”¨httpsåè®®")])])]),t._v(" "),s("h2",{attrs:{id:"_4-nodeæ€§èƒ½å¦‚ä½•ç›‘æ§ä»¥åŠä¼˜åŒ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-nodeæ€§èƒ½å¦‚ä½•ç›‘æ§ä»¥åŠä¼˜åŒ–"}},[t._v("#")]),t._v(" 4. Nodeæ€§èƒ½å¦‚ä½•ç›‘æ§ä»¥åŠä¼˜åŒ–?")]),t._v(" "),s("h3",{attrs:{id:"æ€§èƒ½ä¼˜åŒ–æ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ€§èƒ½ä¼˜åŒ–æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" æ€§èƒ½ä¼˜åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("Nodeä½œä¸ºä¸€é—¨æœåŠ¡ç«¯è¯­è¨€ï¼Œæ€§èƒ½æ–¹é¢å°¤ä¸ºé‡è¦ï¼Œå…¶è¡¡é‡æŒ‡æ ‡ä¸€èˆ¬æœ‰å¦‚ä¸‹ï¼š")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("CPU")])]),t._v(" "),s("li",[s("p",[t._v("å†…å­˜")])]),t._v(" "),s("li",[s("p",[t._v("I/O")])]),t._v(" "),s("li",[s("p",[t._v("ç½‘ç»œ")])])]),t._v(" "),s("blockquote",[s("p",[t._v("CPU ä¸»è¦æœ‰ä¸¤ä¸ªé‡åŒ–æŒ‡æ ‡ï¼š")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("CPUè´Ÿè½½ï¼šåœ¨æŸä¸ªæ—¶é—´æ®µå†…ï¼Œå ç”¨ä»¥åŠç­‰å¾…CPUçš„è¿›ç¨‹æ€»æ•°")])]),t._v(" "),s("li",[s("p",[t._v("CPUä½¿ç”¨ç‡ï¼šCPUæ—¶é—´å ç”¨çŠ¶å†µï¼Œç­‰äº 1 - ç©ºé—²CPUæ—¶é—´(idle time) / CPUæ€»æ—¶é—´")])])]),t._v(" "),s("div",{staticClass:"custom-block right"},[s("p",[t._v("â€”â€”â€”â€” Nodeåº”ç”¨ä¸€èˆ¬ä¸ä¼šæ¶ˆè€—å¾ˆå¤šçš„CPUï¼Œå¦‚æœCPUå ç”¨ç‡é«˜ï¼Œåˆ™è¡¨æ˜åº”ç”¨å­˜åœ¨å¾ˆå¤šåŒæ­¥æ“ä½œï¼Œå¯¼è‡´å¼‚æ­¥ä»»åŠ¡å›è°ƒè¢«é˜»å¡")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// /app/lib/memory.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" os "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'os'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–å½“å‰Nodeå†…å­˜å †æ ˆæƒ…å†µ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rssï¼šè¡¨ç¤ºnodeè¿›ç¨‹å ç”¨çš„å†…å­˜æ€»é‡ã€‚")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// heapTotalï¼šè¡¨ç¤ºå †å†…å­˜çš„æ€»é‡ã€‚")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// heapUsedï¼šå®é™…å †å†…å­˜çš„ä½¿ç”¨é‡ã€‚")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// external ï¼šå¤–éƒ¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨é‡ï¼ŒåŒ…å«Nodeæ ¸å¿ƒçš„C++ç¨‹åºçš„å†…å­˜ä½¿ç”¨é‡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" rss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" heapUsed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" heapTotal "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("memoryUsage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–ç³»ç»Ÿç©ºé—²å†…å­˜")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sysFree "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("freemem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–ç³»ç»Ÿæ€»å†…å­˜")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sysTotal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("totalmem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sys")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" sysFree "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" sysTotal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç³»ç»Ÿå†…å­˜å ç”¨ç‡")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("heap")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" heapUsed "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" heapTotal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Nodeå †å†…å­˜å ç”¨ç‡")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" rss "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" sysTotal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Nodeå ç”¨ç³»ç»Ÿå†…å­˜çš„æ¯”ä¾‹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   sys: 0.9960613250732422,")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   heap: 0.825187360036645,")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   node: 0.0016584396362304688")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n")])])]),s("div",{staticClass:"custom-block right"},[s("p",[t._v("â€”â€”â€”â€” åœ¨Nodeä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹çš„æœ€å¤§å†…å­˜å®¹é‡ä¸º1.5GBã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å‡å°‘å†…å­˜æ³„éœ²")])]),t._v(" "),s("hr"),t._v(" "),s("blockquote",[s("p",[t._v("ç¡¬ç›˜çš„ IO å¼€é”€æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œç¡¬ç›˜ IO èŠ±è´¹çš„ CPU æ—¶é’Ÿå‘¨æœŸæ˜¯å†…å­˜çš„ 164000 å€")])]),t._v(" "),s("blockquote",[s("p",[t._v("å†…å­˜ IO æ¯”ç£ç›˜ IO å¿«éå¸¸å¤šï¼Œæ‰€ä»¥ä½¿ç”¨å†…å­˜ç¼“å­˜æ•°æ®æ˜¯æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•ã€‚å¸¸ç”¨çš„å·¥å…·å¦‚ "),s("strong",[t._v("redis")]),t._v("ã€"),s("strong",[t._v("memcached")]),t._v(" ç­‰")])]),t._v(" "),s("h3",{attrs:{id:"å¦‚ä½•ç›‘æ§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ç›‘æ§"}},[t._v("#")]),t._v(" å¦‚ä½•ç›‘æ§ï¼Ÿ")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" easyMonitor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'easy-monitor'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("easyMonitor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ä½ çš„é¡¹ç›®åç§°'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"ä¼˜åŒ–ä»£ç "}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–ä»£ç "}},[t._v("#")]),t._v(" ä¼˜åŒ–ä»£ç ")]),t._v(" "),s("blockquote",[s("p",[t._v("æ­£ç¡®ä½¿ç”¨Stream")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bad")]),t._v("\nhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/data.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// good")]),t._v("\nhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReadStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/data.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"å†…å­˜ç®¡ç†ä¼˜åŒ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜ç®¡ç†ä¼˜åŒ–"}},[t._v("#")]),t._v(" å†…å­˜ç®¡ç†ä¼˜åŒ–")]),t._v(" "),s("blockquote",[s("p",[t._v("åœ¨ V8 ä¸­ï¼Œä¸»è¦å°†å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ä¸¤ä»£ï¼š")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ–°ç”Ÿä»£ï¼šå¯¹è±¡çš„å­˜æ´»æ—¶é—´è¾ƒçŸ­ã€‚æ–°ç”Ÿå¯¹è±¡æˆ–åªç»è¿‡ä¸€æ¬¡åƒåœ¾å›æ”¶çš„å¯¹è±¡")])]),t._v(" "),s("li",[s("p",[t._v("è€ç”Ÿä»£ï¼šå¯¹è±¡å­˜æ´»æ—¶é—´è¾ƒé•¿ã€‚ç»å†è¿‡ä¸€æ¬¡æˆ–å¤šæ¬¡åƒåœ¾å›æ”¶çš„å¯¹è±¡")])]),t._v(" "),s("li",[s("p",[t._v("è‹¥æ–°ç”Ÿä»£å†…å­˜ç©ºé—´ä¸å¤Ÿï¼Œç›´æ¥åˆ†é…åˆ°è€ç”Ÿä»£")])]),t._v(" "),s("li",[s("p",[t._v("é€šè¿‡å‡å°‘å†…å­˜å ç”¨ï¼Œå¯ä»¥æé«˜æœåŠ¡å™¨çš„æ€§èƒ½ã€‚å¦‚æœæœ‰å†…å­˜æ³„éœ²ï¼Œä¹Ÿä¼šå¯¼è‡´å¤§é‡çš„å¯¹è±¡å­˜å‚¨åˆ°è€ç”Ÿä»£ä¸­ï¼ŒæœåŠ¡å™¨æ€§èƒ½ä¼šå¤§å¤§é™ä½")])])]),t._v(" "),s("p",[t._v("å¦‚ä¸‹é¢æƒ…å†µï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" buffer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/source/index.htm'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        leak"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/source/index.htm'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" leak "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// leakçš„å†…å­˜éå¸¸å¤§ï¼Œé€ æˆå†…å­˜æ³„éœ²ï¼Œåº”å½“é¿å…è¿™æ ·çš„æ“ä½œï¼Œé€šè¿‡å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œæ˜¯æé«˜æœåŠ¡æ€§èƒ½çš„æ‰‹æ®µä¹‹ä¸€")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è€ŒèŠ‚çœå†…å­˜æœ€å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨æ± ï¼Œå…¶å°†é¢‘ç”¨ã€å¯å¤ç”¨å¯¹è±¡å­˜å‚¨èµ·æ¥ï¼Œå‡å°‘åˆ›å»ºå’Œé”€æ¯æ“ä½œ")]),t._v("\n")])])]),s("h2",{attrs:{id:"_5-å¦‚ä½•å°è£…node-jsä¸­é—´ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-å¦‚ä½•å°è£…node-jsä¸­é—´ä»¶"}},[t._v("#")]),t._v(" 5. å¦‚ä½•å°è£…Node.jsä¸­é—´ä»¶ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("åœ¨NodeJSä¸­ï¼Œä¸­é—´ä»¶ä¸»è¦æ˜¯æŒ‡å°è£…httpè¯·æ±‚ç»†èŠ‚å¤„ç†çš„æ–¹æ³•")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ä¾‹å¦‚åœ¨expressã€koaç­‰webæ¡†æ¶ä¸­ï¼Œä¸­é—´ä»¶çš„æœ¬è´¨ä¸ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå‚æ•°åŒ…å«è¯·æ±‚å¯¹è±¡ã€å“åº”å¯¹è±¡å’Œæ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„å‡½æ•°")])]),t._v(" "),s("li",[s("p",[t._v("åœ¨è¿™äº›ä¸­é—´ä»¶å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œä¿®æ”¹è¯·æ±‚å’Œå“åº”å¯¹è±¡ã€è¿”å›å“åº”æ•°æ®ç­‰æ“ä½œ")])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("exports"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("validate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("schema")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("schema"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\t\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"_6-nodejs-ä¸­-require-å‡½æ•°çš„é¡ºåº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-nodejs-ä¸­-require-å‡½æ•°çš„é¡ºåº"}},[t._v("#")]),t._v(" 6. NodeJs ä¸­ require('...') å‡½æ•°çš„é¡ºåº")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ç¼“å­˜çš„æ¨¡å— > å†…ç½®æ¨¡å—(fs/path) > ç›¸å¯¹/ç»å¯¹è·¯å¾„(æœ‰æ–‡ä»¶åç¼€ > æ— æ–‡ä»¶åç¼€) > ç›¸å¯¹/ç»å¯¹è·¯å¾„(æ— æ–‡ä»¶åç¼€) > ç›®å½•/ç¬¬ä¸‰æ–¹æ¨¡å—")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœæ˜¯ç›®å½•ï¼Œåˆ™æ ¹æ® package.jsonçš„mainå±æ€§å€¼å†³å®šç›®å½•ä¸‹å…¥å£æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸º index.js")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœæ–‡ä»¶ä¸ºç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œåˆ™ä¼šå¼•å…¥ node_modules æ–‡ä»¶ï¼Œå¦‚æœä¸åœ¨å½“å‰ä»“åº“æ–‡ä»¶ä¸­ï¼Œåˆ™è‡ªåŠ¨ä»ä¸Šçº§é€’å½’æŸ¥æ‰¾ï¼Œç›´åˆ°æ ¹ç›®å½•")])])]),t._v(" "),s("h2",{attrs:{id:"_7-node-js-äº‹ä»¶å¾ªç¯æœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-node-js-äº‹ä»¶å¾ªç¯æœºåˆ¶"}},[t._v("#")]),t._v(" 7. Node.js äº‹ä»¶å¾ªç¯æœºåˆ¶")]),t._v(" "),s("blockquote",[s("p",[t._v("äº‹ä»¶å¾ªç¯æ˜¯åŸºäºlibuvå®ç°ï¼Œlibuvæ˜¯ä¸€ä¸ªå¤šå¹³å°çš„ä¸“æ³¨äºå¼‚æ­¥IOçš„åº“ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”Œâ”€â”€â”€â–ºâ”‚     timers     â”‚ // setTimeoutã€setInterval\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\nâ”‚             â”‚\nâ”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚    â”‚  I/O callback  â”‚ // ä¸Šä¸€è½®å¾ªç¯æœªè¢«æ‰§è¡Œçš„ä¸€äº› I/O å›è°ƒ\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\nâ”‚             â”‚\nâ”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚    â”‚  idle,prepare  â”‚ // é—²ç½®é˜¶æ®µ\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚             â”‚                      â”‚                â”‚ // æ£€ç´¢ã€æ‰§è¡ŒI/O  \nâ”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”              â”‚    incoming    â”‚ // é™¤äº† setImmediate()\nâ”‚    â”‚      poll      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚ // é€‚å½“é˜»å¡\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   connections  â”‚\nâ”‚             â”‚                      â”‚                â”‚\nâ”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nâ”‚    â”‚     check      â”‚// setImmediate()\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\nâ”‚             â”‚\nâ”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\nâ””â”€â”€â”€â”€â”¤ close callback â”‚ // socket.on('close', ...)\n     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n")])])]),s("ul",[s("li",[s("p",[t._v("æ¯ä¸ªé˜¶æ®µå¯¹åº”ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“äº‹ä»¶å¾ªç¯è¿›å…¥æŸä¸ªé˜¶æ®µæ—¶, å°†ä¼šåœ¨è¯¥é˜¶æ®µå†…æ‰§è¡Œå›è°ƒï¼Œç›´åˆ°é˜Ÿåˆ—è€—å°½æˆ–è€…å›è°ƒçš„æœ€å¤§æ•°é‡å·²æ‰§è¡Œ, é‚£ä¹ˆå°†è¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†é˜¶æ®µ")])]),t._v(" "),s("li",[s("p",[t._v("é™¤äº†ä¸Šè¿°6ä¸ªé˜¶æ®µï¼Œè¿˜å­˜åœ¨"),s("strong",[t._v("process.nextTick")]),t._v("ï¼Œå…¶ä¸å±äºäº‹ä»¶å¾ªç¯çš„ä»»ä½•ä¸€ä¸ªé˜¶æ®µï¼Œå®ƒå±äºè¯¥é˜¶æ®µä¸ä¸‹é˜¶æ®µä¹‹é—´çš„è¿‡æ¸¡, å³æœ¬é˜¶æ®µæ‰§è¡Œç»“æŸ, è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µå‰, æ‰€è¦æ‰§è¡Œçš„å›è°ƒï¼Œç±»ä¼¼æ’é˜Ÿã€‚")])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"é¢˜ç›®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é¢˜ç›®"}},[t._v("#")]),t._v(" é¢˜ç›®")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async1 start'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async1 end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 9")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script start'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 11")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 13")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setImmediate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 12")]),t._v("\n\nprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nextTick1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 7")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nextTick2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 8")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise3'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 6")]),t._v("\n")])])]),s("hr"),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("åˆ†æè¿‡ç¨‹ï¼š\n\nå…ˆæ‰¾åˆ°åŒæ­¥ä»»åŠ¡ï¼Œè¾“å‡ºscript start\n\né‡åˆ°ç¬¬ä¸€ä¸ª setTimeoutï¼Œå°†é‡Œé¢çš„å›è°ƒå‡½æ•°æ”¾åˆ° timer é˜Ÿåˆ—ä¸­\n\né‡åˆ°ç¬¬äºŒä¸ª setTimeoutï¼Œ300msåå°†é‡Œé¢çš„å›è°ƒå‡½æ•°æ”¾åˆ° timer é˜Ÿåˆ—ä¸­\n\né‡åˆ°ç¬¬ä¸€ä¸ªsetImmediateï¼Œå°†é‡Œé¢çš„å›è°ƒå‡½æ•°æ”¾åˆ° check é˜Ÿåˆ—ä¸­\n\né‡åˆ°ç¬¬ä¸€ä¸ª nextTickï¼Œå°†å…¶é‡Œé¢çš„å›è°ƒå‡½æ•°æ”¾åˆ°æœ¬è½®åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œ\n\næ‰§è¡Œ async1å‡½æ•°ï¼Œè¾“å‡º async1 start\n\næ‰§è¡Œ async2 å‡½æ•°ï¼Œè¾“å‡º async2ï¼Œasync2 åé¢çš„è¾“å‡º async1 endè¿›å…¥å¾®ä»»åŠ¡ï¼Œç­‰å¾…ä¸‹ä¸€è½®çš„äº‹ä»¶å¾ªç¯\n\né‡åˆ°ç¬¬äºŒä¸ªï¼Œå°†å…¶é‡Œé¢çš„å›è°ƒå‡½æ•°æ”¾åˆ°æœ¬è½®åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œ\n\né‡åˆ° "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),t._v("ï¼Œæ‰§è¡Œé‡Œé¢çš„ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¾“å‡º promise1ã€promise2\n\nthené‡Œé¢çš„å›è°ƒå‡½æ•°è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—\n\né‡åˆ°åŒæ­¥ä»»åŠ¡ï¼Œè¾“å‡º script end\n\næ‰§è¡Œä¸‹ä¸€è½®å›åˆ°å‡½æ•°ï¼Œå…ˆä¾æ¬¡è¾“å‡º nextTick çš„å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ nextTick1ã€nextTick2\n\nç„¶åæ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¾æ¬¡è¾“å‡º async1 endã€promise3\n\næ‰§è¡Œtimer é˜Ÿåˆ—ï¼Œä¾æ¬¡è¾“å‡º setTimeout0\n\næ¥ç€æ‰§è¡Œ check é˜Ÿåˆ—ï¼Œä¾æ¬¡è¾“å‡º setImmediate\n\n300msåï¼Œtimer é˜Ÿåˆ—å­˜åœ¨ä»»åŠ¡ï¼Œæ‰§è¡Œè¾“å‡º setTimeout2\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"_8-nodeä¸­çš„eventemmiteræ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-nodeä¸­çš„eventemmiteræ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" 8. Nodeä¸­çš„EventEmmiteræ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("Node çš„eventsæ¨¡å—æä¾›äº†ä¸€ä¸ª EventEmitterï¼Œè¿™ä¸ªç±»å®ç°äº†Nodeå¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¶æ„çš„åŸºæœ¬æ¨¡å¼â€”â€”è§‚å¯Ÿè€…æ¨¡å¼")])]),t._v(" "),s("blockquote",[s("p",[t._v("åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œè¢«è§‚å¯Ÿè€…(ä¸»ä½“)ç»´æŠ¤ç€ä¸€ç»„å…¶ä»–å¯¹è±¡æ´¾æ¥(æ³¨å†Œ)çš„è§‚å¯Ÿè€…ï¼Œæœ‰æ–°çš„å¯¹è±¡å¯¹ä¸»ä½“æ„Ÿå…´è¶£å°±æ³¨å†Œè§‚å¯Ÿè€…ï¼Œä¸æ„Ÿå…´è¶£å°±å–æ¶ˆè®¢é˜…ï¼Œä¸»ä½“æœ‰æ›´æ–°çš„è¯å°±ä¾æ¬¡é€šçŸ¥è§‚å¯Ÿè€…ä»¬")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" EventEmitter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'events'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventEmitter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myEmitter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'è§¦å‘äº†eventäº‹ä»¶ï¼'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmyEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ³¨å†Œeventäº‹ä»¶")]),t._v("\nmyEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€šè¿‡emitè§¦å‘")]),t._v("\nmyEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€šè¿‡RemoveListenerå–æ¶ˆæ³¨å†Œ")]),t._v("\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¸¸è§æ–¹æ³•:")]),t._v("\nemitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addListener"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ·»åŠ ç±»å‹ä¸º eventName çš„ç›‘å¬äº‹ä»¶åˆ°äº‹ä»¶æ•°ç»„å°¾éƒ¨")]),t._v("\nemitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prependListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ·»åŠ ç±»å‹ä¸º eventName çš„ç›‘å¬äº‹ä»¶åˆ°äº‹ä»¶æ•°ç»„å¤´éƒ¨")]),t._v("\nemitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è§¦å‘ç±»å‹ä¸º eventName çš„ç›‘å¬äº‹ä»¶")]),t._v("\nemitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("removeListener"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("off")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç§»é™¤ç±»å‹ä¸º eventName çš„ç›‘å¬äº‹ä»¶")]),t._v("\nemitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("once")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ·»åŠ ç±»å‹ä¸º eventName çš„ç›‘å¬äº‹ä»¶ï¼Œä»¥ååªèƒ½æ‰§è¡Œä¸€æ¬¡å¹¶åˆ é™¤")]),t._v("\nemitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeAllListeners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç§»é™¤å…¨éƒ¨ç±»å‹ä¸º eventName çš„ç›‘å¬äº‹ä»¶")]),t._v("\n")])])]),s("h3",{attrs:{id:"å®ç°ä¸€ä¸ªeventemmiter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°ä¸€ä¸ªeventemmiter"}},[t._v("#")]),t._v(" å®ç°ä¸€ä¸ªEventEmmiter")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventEmitter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prependListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unshift")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("off")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Reflect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("once")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_onceWrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_onceWrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("fired")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" type "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" wrapFn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_onceWrapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wrapFn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" wrapFn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" wrapFn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_onceWrapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fired"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fired "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Reflect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("off")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wrapFn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_9-è¯´è¯´å¯¹nodeä¸­streamçš„ç†è§£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-è¯´è¯´å¯¹nodeä¸­streamçš„ç†è§£"}},[t._v("#")]),t._v(" 9. è¯´è¯´å¯¹Nodeä¸­Streamçš„ç†è§£ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("æµï¼ˆStreamï¼‰ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®ä¼ è¾“æ‰‹æ®µï¼Œæ˜¯ç«¯åˆ°ç«¯ä¿¡æ¯äº¤æ¢çš„ä¸€ç§æ–¹å¼ï¼Œè€Œä¸”æ˜¯æœ‰é¡ºåºçš„,æ˜¯é€å—è¯»å–æ•°æ®ã€å¤„ç†å†…å®¹ï¼Œä»¥ Buffer ä¸ºå•ä½")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æµå¯ä»¥åˆ†æˆä¸‰éƒ¨åˆ†ï¼šsourceã€destã€pipe")])]),t._v(" "),s("li",[s("p",[t._v("åœ¨sourceå’Œdestä¹‹é—´æœ‰ä¸€ä¸ªè¿æ¥çš„ç®¡é“pipe,å®ƒçš„åŸºæœ¬è¯­æ³•æ˜¯source.pipe(dest)ï¼Œsourceå’Œdestå°±æ˜¯é€šè¿‡pipeè¿æ¥ï¼Œè®©æ•°æ®ä»sourceæµå‘äº†destï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              â”‚      pipe      â”‚              â”‚\nâ”‚    source    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚     dest     â”‚\nâ”‚              â”‚                â”‚              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n")])])]),s("h3",{attrs:{id:"stream-çš„ç§ç±»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stream-çš„ç§ç±»"}},[t._v("#")]),t._v(" Stream çš„ç§ç±»")]),t._v(" "),s("blockquote",[s("p",[t._v("åœ¨NodeJSï¼Œå‡ ä¹æ‰€æœ‰çš„åœ°æ–¹éƒ½ä½¿ç”¨åˆ°äº†æµçš„æ¦‚å¿µï¼Œåˆ†æˆå››ä¸ªç§ç±»ï¼š")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å¯è¯»æµï¼š å¯è¯»å–æ•°æ®çš„æµã€‚ä¾‹å¦‚fs.createReadStream() å¯ä»¥ä»æ–‡ä»¶è¯»å–å†…å®¹")])]),t._v(" "),s("li",[s("p",[t._v("å¯å†™æµï¼šå¯å†™å…¥æ•°æ®çš„æµã€‚ä¾‹å¦‚ fs.createWriteStream() å¯ä»¥ä½¿ç”¨æµå°†æ•°æ®å†™å…¥æ–‡ä»¶")])]),t._v(" "),s("li",[s("p",[t._v("åŒå·¥æµï¼š æ—¢å¯è¯»åˆå¯å†™çš„æµã€‚ä¾‹å¦‚ net.Socket")])]),t._v(" "),s("li",[s("p",[t._v("è½¬æ¢æµï¼š å¯ä»¥åœ¨æ•°æ®å†™å…¥å’Œè¯»å–æ—¶ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„æµã€‚")]),t._v(" "),s("ul",[s("li",[t._v("ä¾‹å¦‚ï¼Œåœ¨æ–‡ä»¶å‹ç¼©æ“ä½œä¸­ï¼Œå¯ä»¥å‘æ–‡ä»¶å†™å…¥å‹ç¼©æ•°æ®ï¼Œå¹¶ä»æ–‡ä»¶ä¸­è¯»å–è§£å‹æ•°æ®")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("åœ¨NodeJSä¸­HTTPæœåŠ¡å™¨æ¨¡å—ä¸­ï¼Œrequest æ˜¯å¯è¯»æµï¼Œresponse æ˜¯å¯å†™æµã€‚\nè¿˜æœ‰fsæ¨¡å—ï¼Œèƒ½åŒæ—¶å¤„ç†å¯è¯»å’Œå¯å†™æ–‡ä»¶æµ\n\nå¯è¯»æµå’Œå¯å†™æµéƒ½æ˜¯å•å‘çš„ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œè€Œå¦å¤–ä¸¤ä¸ªæ˜¯åŒå‘çš„\n")])])]),s("h3",{attrs:{id:"åŒå·¥æµ-demo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŒå·¥æµ-demo"}},[t._v("#")]),t._v(" åŒå·¥æµ demo")]),t._v(" "),s("blockquote",[s("p",[t._v("æ¯”å¦‚ websocket é€šä¿¡ï¼Œæ˜¯ä¸€ä¸ªå…¨åŒå·¥é€šä¿¡ï¼Œå‘é€æ–¹å’Œæ¥å—æ–¹éƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„æ–¹æ³•ï¼Œå‘é€å’Œæ¥æ”¶éƒ½æ²¡æœ‰ä»»ä½•å…³ç³»")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Duplex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stream'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myDuplex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duplex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" encoding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"è½¬æ¢æµ-demo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è½¬æ¢æµ-demo"}},[t._v("#")]),t._v(" è½¬æ¢æµ demo")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Transform "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stream'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myTransform "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("transform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" encoding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"ä¸»è¦åº”ç”¨åœºæ™¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»è¦åº”ç”¨åœºæ™¯"}},[t._v("#")]),t._v(" ä¸»è¦åº”ç”¨åœºæ™¯")]),t._v(" "),s("p",[t._v("streamçš„åº”ç”¨åœºæ™¯ä¸»è¦å°±æ˜¯å¤„ç†IOæ“ä½œï¼Œè€Œhttpè¯·æ±‚å’Œæ–‡ä»¶æ“ä½œéƒ½å±äºIOæ“ä½œ")]),t._v(" "),s("p",[t._v("æ€æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸€æ¬¡IOæ“ä½œè¿‡å¤§ï¼Œç¡¬ä»¶çš„å¼€é”€å°±è¿‡å¤§ï¼Œè€Œå°†æ­¤æ¬¡å¤§çš„IOæ“ä½œè¿›è¡Œåˆ†æ®µæ“ä½œï¼Œè®©æ•°æ®åƒæ°´ç®¡ä¸€æ ·æµåŠ¨ï¼ŒçŸ¥é“æµåŠ¨å®Œæˆ")]),t._v(" "),s("p",[t._v("å¸¸è§çš„åœºæ™¯æœ‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ–‡ä»¶æ“ä½œ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºä¸€ä¸ªå¯è¯»æ•°æ®æµreadStreamï¼Œä¸€ä¸ªå¯å†™æ•°æ®æµwriteStreamï¼Œé€šè¿‡pipeç®¡é“æŠŠæ•°æ®æµè½¬è¿‡å»")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸¤ä¸ªæ–‡ä»¶å")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fileName1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fileName2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data-bak.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¯»å–æ–‡ä»¶çš„ stream å¯¹è±¡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readStream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReadStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileName1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å†™å…¥æ–‡ä»¶çš„ stream å¯¹è±¡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" writeStream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWriteStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileName2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€šè¿‡ pipeæ‰§è¡Œæ‹·è´ï¼Œæ•°æ®æµè½¬")]),t._v("\nreadStream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("writeStream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ•°æ®è¯»å–å®Œæˆç›‘å¬ï¼Œå³æ‹·è´å®Œæˆ")]),t._v("\nreadStream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'æ‹·è´å®Œæˆ'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¯»å–minioClientçš„å›¾ç‰‡(ReadableStream)ï¼Œç„¶åè½¬æ¢æˆbase64")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" S3FileAdapter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("minioClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bucketName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("each"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" chunks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nreadable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'readable'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log('Stream is readable (new data received in buffer)');")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Use a loop to make sure we read all currently available data")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chunk "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" readable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log(`Read ${chunk.length} bytes of data...`);")]),t._v("\n    chunks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nreadable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" content "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" chunks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// [Uint8Array(13343), Uint8Array(27960), Uint8Array(65536), Uint8Array(2114),...]")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†ç»“æœé‡ç»„æˆarrayå½¢å¼")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" base64 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'base64'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" thumbnail "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data:image/jpeg;base64,'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" base64"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ok...")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Read data end Length : ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"_10-node-stream-æ˜¯ä»€ä¹ˆ-æœ‰å“ªäº›ç§ç±»çš„-stream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-node-stream-æ˜¯ä»€ä¹ˆ-æœ‰å“ªäº›ç§ç±»çš„-stream"}},[t._v("#")]),t._v(" 10. Node Stream æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ç§ç±»çš„ Streamï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("åœ¨ Node.js ä¸­ï¼ŒStream æ˜¯ä¸€ç§ç”¨äº"),s("strong",[t._v("å¤„ç†æµæ•°æ®çš„æŠ½è±¡æ¥å£")]),t._v("ã€‚å®ƒæä¾›äº†ä¸€ç§å¤„ç†å¤§é‡æ•°æ®çš„æ–¹å¼ï¼Œä»¥åŠå¯¹æ•°æ®è¿›è¡Œæµå¼ä¼ è¾“å’Œå¤„ç†çš„èƒ½åŠ›ã€‚Stream å¯ä»¥é€šè¿‡"),s("strong",[t._v("è¯»å–ã€å†™å…¥ã€è½¬æ¢ã€è¿‡æ»¤")]),t._v("ç­‰æ–¹å¼æ¥å¤„ç†æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®åˆ°å†…å­˜ä¸­ã€‚è¿™ä½¿å¾—å¤„ç†å¤§æ–‡ä»¶æˆ–å¤§é‡æ•°æ®å˜å¾—æ›´åŠ é«˜æ•ˆå’Œå¯è¡Œã€‚Node.js ä¸­çš„ Stream æœ‰å››ç§ç±»å‹ï¼š")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ç±»å‹")]),t._v(" "),s("th",[t._v("æè¿°")]),t._v(" "),s("th",[t._v("å…¸å‹ç¤ºä¾‹")]),t._v(" "),s("th",[t._v("é‡è¦äº‹ä»¶")]),t._v(" "),s("th",[t._v("é‡è¦æ–¹æ³•")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("Readable")]),t._v(" (å¯è¯»æµ)")]),t._v(" "),s("td",[t._v("æ•°æ®æ¥æºï¼Œå¯ä»¥è¢«è¯»å–")]),t._v(" "),s("td",[t._v("æ–‡ä»¶è¯»å–æµã€HTTP è¯·æ±‚ã€process.stdin")]),t._v(" "),s("td",[s("code",[t._v("data")]),t._v(", "),s("code",[t._v("end")]),t._v(", "),s("code",[t._v("error")]),t._v(", "),s("code",[t._v("close")])]),t._v(" "),s("td",[s("code",[t._v("pipe()")]),t._v(", "),s("code",[t._v("read()")]),t._v(", "),s("code",[t._v("pause()")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Writable")]),t._v(" (å¯å†™æµ)")]),t._v(" "),s("td",[t._v("æ•°æ®ç›®æ ‡ï¼Œå¯ä»¥è¢«å†™å…¥")]),t._v(" "),s("td",[t._v("æ–‡ä»¶å†™å…¥æµã€HTTP å“åº”ã€process.stdout")]),t._v(" "),s("td",[s("code",[t._v("drain")]),t._v(", "),s("code",[t._v("finish")]),t._v(", "),s("code",[t._v("error")])]),t._v(" "),s("td",[s("code",[t._v("write()")]),t._v(", "),s("code",[t._v("end()")]),t._v(", "),s("code",[t._v("cork()")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Duplex")]),t._v(" (åŒå·¥æµ)")]),t._v(" "),s("td",[t._v("åŒæ—¶å®ç° Readable å’Œ Writable æ¥å£ï¼Œè¯»å†™é€šé“ç‹¬ç«‹")]),t._v(" "),s("td",[t._v("TCP socketsã€WebSocketsã€child_process IPC")]),t._v(" "),s("td",[t._v("åŒ…å«å¯è¯»å’Œå¯å†™æµçš„æ‰€æœ‰äº‹ä»¶")]),t._v(" "),s("td",[t._v("åŒ…å«å¯è¯»å’Œå¯å†™æµçš„æ‰€æœ‰æ–¹æ³•")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Transform")]),t._v(" (è½¬æ¢æµ)")]),t._v(" "),s("td",[t._v("ç‰¹æ®Šçš„ Duplex æµï¼Œå†™å…¥å’Œè¯»å–æ—¶è‡ªåŠ¨è½¬æ¢æ•°æ®ï¼ˆè¾“å‡ºä¸è¾“å…¥æœ‰è®¡ç®—/è½¬æ¢å…³ç³»ï¼‰")]),t._v(" "),s("td",[t._v("zlib å‹ç¼©æµã€åŠ å¯†æµã€CSV è§£æå™¨")]),t._v(" "),s("td",[s("code",[t._v("data")]),t._v(", "),s("code",[t._v("end")]),t._v(", "),s("code",[t._v("finish")])]),t._v(" "),s("td",[s("code",[t._v("_transform()")]),t._v(", "),s("code",[t._v("_flush()")])])])])]),t._v(" "),s("h2",{attrs:{id:"_11-å®ä»»åŠ¡-å¾®ä»»åŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-å®ä»»åŠ¡-å¾®ä»»åŠ¡"}},[t._v("#")]),t._v(" 11.å®ä»»åŠ¡ / å¾®ä»»åŠ¡")]),t._v(" "),s("blockquote",[s("p",[t._v("å®ä»»åŠ¡ï¼ˆMacro Taskï¼‰å’Œå¾®ä»»åŠ¡ï¼ˆMicro Taskï¼‰æ˜¯ä¸äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ç›¸å…³çš„æ¦‚å¿µï¼Œç”¨äºç®¡ç† JavaScript ä»£ç çš„æ‰§è¡Œé¡ºåºå’Œå¼‚æ­¥æ“ä½œã€‚å®ƒä»¬æœ‰åŠ©äºç†è§£ JavaScript ä¸­çš„å¼‚æ­¥ç¼–ç¨‹å’Œäº‹ä»¶å¤„ç†")])]),t._v(" "),s("h3",{attrs:{id:"å®ä»»åŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®ä»»åŠ¡"}},[t._v("#")]),t._v(" å®ä»»åŠ¡")]),t._v(" "),s("p",[s("strong",[t._v("å®ä»»åŠ¡ä»£è¡¨ä¸€ç»„ä¸€èµ·æ‰§è¡Œçš„æ“ä½œ")]),t._v("ï¼Œé€šå¸¸æ˜¯ç”±å¼€å‘è€…å®šä¹‰çš„å¼‚æ­¥æ“ä½œæˆ–äº‹ä»¶ã€‚")]),t._v(" "),s("p",[t._v("å®ä»»åŠ¡åŒ…æ‹¬è¯¸å¦‚"),s("code",[t._v("setTimeout")]),t._v("ã€"),s("code",[t._v("setInterval")]),t._v("ã€"),s("code",[t._v("I/O")]),t._v("æ“ä½œç­‰ã€‚")]),t._v(" "),s("p",[t._v("å½“å®ä»»åŠ¡è¢«æ·»åŠ åˆ°æ‰§è¡Œé˜Ÿåˆ—æ—¶ï¼Œå®ƒä»¬ä¼šè¢«æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼Œç›´åˆ° JavaScript å¼•æ“å¯ä»¥æ‰§è¡Œå®ƒä»¬ã€‚ä¸€æ¬¡åªæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ã€‚")]),t._v(" "),s("h3",{attrs:{id:"å¾®ä»»åŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¾®ä»»åŠ¡"}},[t._v("#")]),t._v(" å¾®ä»»åŠ¡")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å¾®ä»»åŠ¡ä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œï¼Œä½†å®ƒä»¬çš„"),s("strong",[t._v("ä¼˜å…ˆçº§é«˜äºå®ä»»åŠ¡")]),t._v("ã€‚å¾®ä»»åŠ¡åŒ…æ‹¬"),s("code",[t._v("new Promise().then")]),t._v("ã€MutationObserver çš„å›è°ƒç­‰ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å½“ä¸€ä¸ªå¾®ä»»åŠ¡è¢«æ·»åŠ åˆ°æ‰§è¡Œé˜Ÿåˆ—æ—¶ï¼Œå®ƒä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œä¸éœ€è¦ç­‰å¾…å½“å‰çš„å®ä»»åŠ¡å®Œæˆã€‚\nå› æ­¤ï¼Œ"),s("strong",[t._v("å¾®ä»»åŠ¡èƒ½å¤Ÿåœ¨å®ä»»åŠ¡ä¹‹é—´æ‰§è¡Œ")]),t._v("ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¾®ä»»åŠ¡é€šå¸¸ç”¨äºæ‰§è¡Œä¸å½“å‰ä»»åŠ¡ç›¸å…³çš„æ¸…ç†ã€å›è°ƒæˆ–æ›´æ–°æ“ä½œã€‚")])])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"title"}),s("p",[t._v("äº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªä¸æ–­è¿è¡Œçš„å¾ªç¯ï¼Œå®ƒè´Ÿè´£æ‰§è¡Œå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œä»¥ç¡®ä¿ JavaScript ä»£ç èƒ½å¤ŸæŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚")]),t._v(" "),s("p",[t._v("ğŸ‘€ äº‹ä»¶å¾ªç¯çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­é€‰æ‹©æœ€æ—©çš„ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œã€‚")]),t._v(" "),s("li",[t._v("æ‰§è¡Œå®Œå½“å‰å®ä»»åŠ¡åï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶ä¾æ¬¡æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºã€‚")]),t._v(" "),s("li",[t._v("å›åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œé€‰æ‹©ä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œã€‚")])]),t._v(" "),s("p",[t._v("é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œä¸æ–­å¾ªç¯æ‰§è¡Œå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆã€‚")])]),s("h2",{attrs:{id:"_12-ä»€ä¹ˆæ˜¯nodejs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-ä»€ä¹ˆæ˜¯nodejs"}},[t._v("#")]),t._v(" 12. ä»€ä¹ˆæ˜¯Nodejsï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“ çš„ JavaScript è¿è¡Œæ—¶ï¼Œç”¨äºåœ¨æœåŠ¡å™¨ç«¯é«˜æ•ˆè¿è¡Œ JavaScript ä»£ç ã€‚å®ƒé‡‡ç”¨ äº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/O æ¨¡å‹ï¼Œä½¿å…¶è½»é‡ä¸”é«˜æ•ˆï¼Œç‰¹åˆ«é€‚åˆæ„å»ºé«˜æ€§èƒ½ã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ã€‚")])])])}),[],!1,null,null,null);s.default=e.exports}}]);